function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["_astro/index.vCJ-_cIy.js","_astro/index.Dkgbun3A.js","_astro/scope.M_6gkdev.js","_astro/browser.Bdhvn36h.js","_astro/_commonjsHelpers.BosuxZz1.js","_astro/index.jPZcmtW4.js","_astro/index.Bj5LU-in.js","_astro/index.6h12LIjg.js","_astro/hydra.DR7EVVgQ.js","_astro/preload-helper.BO48x9DZ.js","_astro/serial.BPtmSo0r.js","_astro/index.kVeZ0DDY.js","_astro/tidal.D_bodmyB.js","_astro/loggerbridge.kyr5zX5S.js","_astro/index.DIn8BZQ7.js","_astro/midibridge.DRyf-tQB.js","_astro/utils.BmXqTdNi.js","_astro/oscbridge.BcorbPHJ.js","_astro/index.BH6n4fe0.js","_astro/osc.B4iWeLtK.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as S,p as ys,b as bs,g as ks,e as Ss,f as Es,h as Ts,k as Os,m as Ps,l as As,n as $s,o as js,q as Rs,r as Cs,d as xs,c as Is,s as Ls,S as Ds,u as Us,v as Fs,w as Ns,x as Ms,y as zs,z as Bs,A as qs,B as Js,C as Vs,D as Hs,E as Ks,F as Gs,G as Ws,H as Xs,I as Ys,J as Zs,K as Qs,a as er,L as tr,M as sr,N as rr,O as ir,i as nr,P as ar,Q as or,R as cr,T as lr,U as hr,V as ur,W as dr}from"./preload-helper.BO48x9DZ.js";import{g as I,j as At,r as H,a as Ee,k as ee,b as Te,l as $t,d as Je,c as Ve,m as He,n as jt,o as Rt,p as at,q as Ct,t as xt,u as It,v as Lt,x as Ke,y as te,z as Dt,A as Ut,B as Ft,C as fr,w as pr,D as gr,E as _r,F as mr,s as wr,G as vr,H as yr,I as br,J as kr,K as Sr,h as Er,L as Tr,i as Or,e as Pr,M as Ar,N as $r,O as jr,P as Rr,Q as Cr,f as xr,R as Ir,S as Lr,T as Dr,U as Ur,V as Fr,W as Nr,X as Mr,Y as zr,Z as Br,_ as qr,$ as Jr,a0 as Vr,a1 as Hr}from"./scope.M_6gkdev.js";import{G as A,v as Nt,P as Mt,a5 as zt,I as Kr,a2 as Ge,a6 as Gr,a7 as Wr}from"./index.Dkgbun3A.js";import{r as ue}from"./index.DIn8BZQ7.js";/* empty css                      */const Xr=Object.freeze(Object.defineProperty({__proto__:null,SyntaxError:Rs,getLeafLocation:ks,getLeafLocations:Ts,getLeaves:Es,h:As,m:Ps,mini:Os,mini2ast:Ss,miniAllStrings:js,minify:$s,parse:Cs,patternifyAST:bs},Symbol.toStringTag,{value:"Module"}));function Yr(r,e,t){let s=new Set([...e,void 0]);return r.listen((i,n)=>{s.has(n)&&t(i,n)})}let Re={};function Zr(r,e){const t=I();if(Re[r])return Re[r];const s=2*t.sampleRate,i=t.createBuffer(1,s,t.sampleRate),n=i.getChannelData(0);let a=0,o,c,l,h,u,d,f;o=c=l=h=u=d=f=0;for(let g=0;g<s;g++)if(r==="white")n[g]=Math.random()*2-1;else if(r==="brown"){let p=Math.random()*2-1;n[g]=(a+.02*p)/1.02,a=n[g]}else if(r==="pink"){let p=Math.random()*2-1;o=.99886*o+p*.0555179,c=.99332*c+p*.0750759,l=.969*l+p*.153852,h=.8665*h+p*.3104856,u=.55*u+p*.5329522,d=-.7616*d-p*.016898,n[g]=o+c+l+h+u+d+f+p*.5362,n[g]*=.11,f=p*.115926}else if(r==="crackle"){const p=e*.01;Math.random()<p?n[g]=Math.random()*2-1:n[g]=0}return r!=="crackle"&&(Re[r]=i),i}function Bt(r="white",e,t=.02){const i=I().createBufferSource();return i.buffer=Zr(r,t),i.loop=!0,i.start(e),{node:i,stop:n=>i.stop(n)}}function Qr(r,e,t){const s=Bt("pink",t);return{node:At(r,s.node,e),stop:n=>s?.stop(n)}}const qt=r=>{let{note:e,freq:t}=r;return e=e||36,typeof e=="string"&&(e=Rt(e)),!t&&typeof e=="number"&&(t=Ct(e)),Number(t)},ei=["triangle","square","sawtooth","sine"],ti=["pink","white","brown","crackle"];function Jt(){[...ei].forEach(r=>{H(r,(e,t,s)=>{const[i,n,a,o]=Ee([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]);let c=Ht(r,e,t),{node:l,stop:h,triggerRelease:u}=c;const d=ee(.3),{duration:f}=t;l.onended=()=>{l.disconnect(),d.disconnect(),s()};const g=ee(1);let p=l.connect(d).connect(g);const _=e+f;Te(p.gain,i,n,a,o,0,1,e,_,"linear");const y=_+o+.01;return u?.(y),h(y),{node:p,stop:b=>{}}},{type:"synth",prebake:!0})}),H("supersaw",(r,e,t)=>{const s=I();let{duration:i,n,unison:a=5,spread:o=.6,detune:c}=e;c=c??n??.18;const l=qt(e),[h,u,d,f]=Ee([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),g=r+i,p=g+f+.01,_=at(a,1,100);let y=_>1?at(o,0,1):0,b=$t(s,"supersaw-oscillator",{frequency:l,begin:r,end:p,freqspread:c,voices:_,panspread:y},{outputChannelCount:[2]});const T=1/Math.sqrt(_);Je(b.parameters.get("detune"),e,r,g);const v=Ve(b.parameters.get("detune"),e,r),E=He(b.parameters.get("frequency"),e,r);let D=ee(1);return D=b.connect(D),jt(s,()=>{b.disconnect(),D.disconnect(),t(),E?.stop(),v?.stop()},r,p),Te(D.gain,h,u,d,f,0,.3*T,r,g,"linear"),{node:D,stop:ge=>{}}},{prebake:!0,type:"synth"}),[...ti].forEach(r=>{H(r,(e,t,s)=>{const[i,n,a,o]=Ee([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]);let c,{density:l}=t;c=Bt(r,e,l);let{node:h,stop:u,triggerRelease:d}=c;const f=ee(.3),{duration:g}=t;h.onended=()=>{h.disconnect(),f.disconnect(),s()};const p=ee(1);let _=h.connect(f).connect(p);const y=e+g;Te(_.gain,i,n,a,o,0,1,e,y,"linear");const b=y+o+.01;return d?.(b),u(b),{node:_,stop:T=>{}}},{type:"synth",prebake:!0})})}function Vt(r,e){const t=new Float32Array(r+1),s=new Float32Array(r+1),i=I(),n=i.createOscillator(),a={sawtooth:l=>[0,-1/l],square:l=>[0,l%2===0?0:1/l],triangle:l=>[l%2===0?0:1/(l*l),0]};if(!a[e])throw new Error(`unknown wave type ${e}`);t[0]=0,s[0]=0;let o=1;for(;o<=r;){const[l,h]=a[e](o);t[o]=l,s[o]=h,o++}const c=i.createPeriodicWave(t,s);return n.setPeriodicWave(c),n}function Ht(r,e,t){let{n:s,duration:i,noise:n=0}=t,a;!s||r==="sine"?(a=I().createOscillator(),a.type=r||"triangle"):a=Vt(s,r),a.frequency.value=qt(t),a.start(e);let o=Ve(a.detune,t,e);Je(a.detune,t,e,e+i);const c=He(a.frequency,t,e);let l;return n&&(l=Qr(a,n,e)),{node:l?.node||a,stop:h=>{c.stop(h),o?.stop(h),l?.stop(h),a.stop(h)},triggerRelease:h=>{}}}function si(r=1,e=.05,t=220,s=0,i=0,n=.1,a=0,o=1,c=0,l=0,h=0,u=0,d=0,f=0,g=0,p=0,_=0,y=1,b=0,T=0){let v=Math.PI*2,E=I().sampleRate,D=vs=>vs>0?1:-1,ge=c*=500*v/E/E,_e=t*=(1+e*2*Math.random()-e)*v/E,me=[],L=0,we=0,O=0,U=1,ms=0,ws=0,F=0,je,G;for(s=s*E+9,b*=E,i*=E,n*=E,_*=E,l*=500*v/E**3,g*=v/E,h*=v/E,u*=E,d=d*E|0,G=s+b+i+n+_|0;O<G;me[O++]=F)++ws%(p*100|0)||(F=a?a>1?a>2?a>3?Math.sin((L%v)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/v%2+2)%2:1-4*Math.abs(Math.round(L/v)-L/v):Math.sin(L),F=(d?1-T+T*Math.sin(v*O/d):1)*D(F)*Math.abs(F)**o*r*1*(O<s?O/s:O<s+b?1-(O-s)/b*(1-y):O<s+b+i?y:O<G-_?(G-O-_)/n*y:0),F=_?F/2+(_>O?0:(O<G-_?1:(G-O)/_)*me[O-_|0]/2):F),je=(t+=c+=l)*Math.cos(g*we++),L+=je-je*f*(1-(Math.sin(O)+1)*1e9%2),U&&++U>u&&(t+=h,_e+=h,U=0),d&&!(++ms%d)&&(t=_e,c=ge,U||=1);return me}const Kt=(r,e)=>{let{s:t,note:s=36,freq:i,zrand:n=0,attack:a=0,decay:o=0,sustain:c=.8,release:l=.1,curve:h=1,slide:u=0,deltaSlide:d=0,pitchJump:f=0,pitchJumpTime:g=0,lfo:p=0,znoise:_=0,zmod:y=0,zcrush:b=0,zdelay:T=0,tremolo:v=0,duration:E=.2,zzfx:D}=r;const ge=Math.max(E-a-o,0);typeof s=="string"&&(s=Rt(s)),!i&&typeof s=="number"&&(i=Ct(s)),t=t.replace("z_","");const _e=["sine","triangle","sawtooth","tan","noise"].indexOf(t)||0;h=t==="square"?0:h;const L=si(...D||[.25,n,i,a,ge,l,_e,h,u,d,f,g,p,_,y,b,T,c,o,v]),we=I(),O=we.createBuffer(1,L.length,we.sampleRate);O.getChannelData(0).set(L);const U=I().createBufferSource();return U.buffer=O,U.start(e),{node:U}};function Gt(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(r=>{H(r,(e,t,s)=>{const{node:i}=Kt({s:r,...t},e);return i.onended=()=>{i.disconnect(),s()},{node:i,stop:()=>{}}},{type:"synth",prebake:!0})})}const ri=Object.freeze(Object.defineProperty({__proto__:null,get analysers(){return $r},get analysersData(){return jr},applyFM:He,connectToDestination:Pr,createFilter:zr,dough:Vr,doughTrigger:Hr,drawFrequencyScope:mr,drawTimeScope:_r,drywet:At,dspWorklet:Jr,gainNode:ee,getADSRValues:Ee,getAnalyserById:Rr,getAnalyzerData:Cr,getAudioContext:I,getCachedBuffer:Dr,getCompressor:Mr,getDefaultValue:br,getLoadedBuffer:Nr,getOscillator:Ht,getParamADSR:Te,getPitchEnvelope:Je,getSampleBufferSource:Ur,getSound:vr,getVibratoOscillator:Ve,getWorklet:$t,getZZFX:Kt,initAudio:Tr,initAudioOnFirstClick:Or,initializeAudioOutput:Ut,loadBuffer:It,logger:Br,onTriggerSample:Ke,panic:Ar,processSampleMap:Lt,registerSamplesPrefix:xt,registerSound:H,registerSynthSounds:Jt,registerZZFXSounds:Gt,resetDefaultValues:Sr,resetGlobalEffects:xr,resetLoadedSounds:Er,reverseBuffer:Fr,samples:te,setDefaultAudioContext:Dt,setDefaultValue:yr,setDefaultValues:kr,setLogger:qr,setVersionDefaults:Ft,soundMap:wr,superdough:Ir,superdoughTrigger:Lr,waveformN:Vt,webAudioTimeout:jt,webaudioOutput:pr,webaudioOutputTrigger:fr,webaudioRepl:gr},Symbol.toStringTag,{value:"Module"})),ii=Object.freeze(Object.defineProperty({__proto__:null,BlockWidget:hr,SliderWidget:Gs,StrudelMirror:Ds,activateTheme:ar,addWidget:or,codemirrorSettings:Is,defaultSettings:xs,flash:Vs,flashField:Js,highlightExtension:zs,highlightMiniLocations:Ms,initEditor:Ls,initTheme:nr,injectStyle:ir,isFlashEnabled:Hs,isPatternHighlightingEnabled:Bs,registerWidget:dr,setFlash:qs,setMiniLocations:Us,setSliderWidgets:Ws,setWidget:lr,settings:tr,showMiniLocations:Fs,slider:Zs,sliderPlugin:Ys,sliderValues:Ks,sliderWithID:Qs,theme:rr,themeColors:sr,themes:er,updateMiniLocations:Ns,updateSliderWidgets:Xs,updateWidgets:cr,widgetPlugin:ur},Symbol.toStringTag,{value:"Module"}));let Wt;typeof window<"u"&&(Wt=window?.__TAURI__);const{BaseDirectory:ni,readDir:ai,readBinaryFile:oi,writeTextFile:ci,readTextFile:li,exists:hi}=Wt?.fs||{},de=ni?.Audio,ot="~/music/";async function ui(r){return hi(r+"/strudel.json",{dir:de})}async function di(r){const e=await li(r+"/strudel.json",{dir:de}),t=JSON.parse(e);Lt(t,(s,i)=>{H(s,(n,a,o)=>Ke(n,a,o,i,gi(r)),{type:"sample",samples:i,fileSystem:!0,tag:"local"})})}async function fi(r){const e=await ai(r,{dir:de,recursive:!0}),s={name:r.split("/").slice(-1)[0],children:e};let i={},n=0;Xt(s,(c,l)=>{["wav","mp3"].includes(c.name.split(".").slice(-1)[0])&&(i[l.name]=i[l.name]||[],n+=1,i[l.name].push(c.subpath.slice(1).concat([c.name]).join("/")))});const a=JSON.stringify(i,null,2),o=r+"/strudel.json";await ci(o,a,{dir:de}),console.log(`wrote strudel.json with ${n} samples to ${r}!`)}xt(ot,async r=>{const e=r.replace(ot,"");return await ui(e)||await fi(e),di(e)});const Xt=(r,e)=>{if(Array.isArray(r?.children))for(const t of r.children)t.subpath=(r.subpath||[]).concat([r.name]),e(t,r),t.children&&Xt(t,e)},Yt=r=>["wav","mp3","flac","ogg","m4a","aac"].includes(r.split(".").slice(-1)[0]);function pi(r){const e=new Blob([r],{type:"audio/*"});return URL.createObjectURL(e)}const ve={};async function Zt(r){return ve[r]||(ve[r]=(async()=>{const e=await oi(r,{dir:de});return pi(e)})()),ve[r]}const gi=r=>e=>Zt(r.endsWith("/")?r+e:r+"/"+e);async function Pa(r){const e=await Zt(r),t=I(),s=t.createBufferSource();s.buffer=await It(e,t),s.connect(t.destination),s.start(t.currentTime)}const _i={dbName:"samples",table:"usersamples",columns:["blob","title"],version:1};function mi(r=_i,e=()=>{}){Qt(r,t=>{const s=t.getAll();s.onerror=i=>{A("User Samples failed to load ","error"),e(),console.error(i?.target?.error)},s.onsuccess=i=>{const n=i.target.result;if(!n?.length)return;const a=new Map;Promise.all([...n].sort((o,c)=>o.title.localeCompare(c.title,void 0,{numeric:!0,sensitivity:"base"})).map((o,c)=>{const l=o.title;if(!Yt(l))return;const h=o.id.split("/");let u=h[h.length-2]??o.id.split(/\W+/)[0]??"user";const d=o.blob;if(typeof d=="string"){const f=a.get(u)??new Set;f.add(d),a.set(u,f);return}return wi(d).then(f=>{const g=a.get(u)??new Set;g.add(f),a.set(u,g)})})).then(()=>{a.forEach((o,c)=>{const l=Array.from(o);H(c,(h,u,d)=>Ke(h,u,d,l),{type:"sample",samples:l,baseUrl:void 0,prebake:!1,tag:void 0})}),A("imported sounds registered!","success"),e()}).catch(o=>{A("Something went wrong while registering saved samples from the index db","error"),console.error(o)})}})}async function wi(r){return new Promise(e=>{var t=new FileReader;t.onload=function(s){e(s.target.result)},t.readAsDataURL(r)})}function Qt(r,e){const{dbName:t,version:s,table:i,columns:n}=r;if(typeof window>"u")return;if(!("indexedDB"in window)){console.log("IndexedDB is not supported.");return}const a=indexedDB.open(t,s);return a.onupgradeneeded=o=>{const l=a.result.createObjectStore(i,{keyPath:"id",autoIncrement:!1});n.forEach(h=>{l.createIndex(h,h,{unique:!1})})},a.onerror=o=>{A("Something went wrong while trying to open the the client DB","error"),console.error(`indexedDB error: ${o.errorCode}`)},a.onsuccess=()=>{const o=a.result,l=o.transaction([i],"readwrite").objectStore(i);e(l,o)},a}async function vi(r){return Promise.all(Array.from(r).map(e=>{const t=e.name;if(!Yt(t))return;const s=URL.createObjectURL(e);return fetch(s).then(i=>i.blob().then(n=>{const a=e.webkitRelativePath;let o=a?.length?a:t;if(!(o==null||t==null||n==null))return{title:t,blob:n,id:o}}))}).filter(Boolean)).catch(e=>{A("Something went wrong while processing uploaded files","error"),console.error(e)})}async function Aa(r,e){A("procesing user samples..."),await vi(e).then(t=>{A("user samples processed... opening db"),Qt(r,(i,n)=>{A("index db opened... writing files to db"),t.forEach(a=>{a!=null&&i.put(a)}),A("user samples written successfully")})})}const yi=Nt("C8"),bi=(r,e)=>r*e+(1-e)/2;Mt.prototype.piano=function(){return this.clip(1).s("piano").release(.1).fmap(r=>{const e=zt(r),t=bi(Math.min(Math.round(e)/yi,1),.5);return{...r,pan:(r.pan||1)*t}})};const{BASE_URL:Ce}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://strudel.cc/",ASSETS_PREFIX:void 0},ye=Ce.endsWith("/")?Ce.slice(0,-1):Ce;async function $a(){await Promise.all([Jt(),Gt(),mi(),S(()=>import("./index.vCJ-_cIy.js"),__vite__mapDeps([0,1,2])).then(({registerSoundfonts:r})=>r()),te(`${ye}/piano.json`,void 0,{prebake:!0}),te(`${ye}/vcsl.json`,"github:sgossner/VCSL/master/",{prebake:!0}),te(`${ye}/tidal-drum-machines.json`,"github:ritchse/tidal-drum-machines/main/machines/",{prebake:!0,tag:"drum-machines"}),te(`${ye}/EmuSP12.json`,void 0,{prebake:!0,tag:"drum-machines"}),te({casio:["casio/high.wav","casio/low.wav","casio/noise.wav"],crow:["crow/000_crow.wav","crow/001_crow2.wav","crow/002_crow3.wav","crow/003_crow4.wav"],insect:["insect/000_everglades_conehead.wav","insect/001_robust_shieldback.wav","insect/002_seashore_meadow_katydid.wav"],wind:["wind/000_wind1.wav","wind/001_wind10.wav","wind/002_wind2.wav","wind/003_wind3.wav","wind/004_wind4.wav","wind/005_wind5.wav","wind/006_wind6.wav","wind/007_wind7.wav","wind/008_wind8.wav","wind/009_wind9.wav"],jazz:["jazz/000_BD.wav","jazz/001_CB.wav","jazz/002_FX.wav","jazz/003_HH.wav","jazz/004_OH.wav","jazz/005_P1.wav","jazz/006_P2.wav","jazz/007_SN.wav"],metal:["metal/000_0.wav","metal/001_1.wav","metal/002_2.wav","metal/003_3.wav","metal/004_4.wav","metal/005_5.wav","metal/006_6.wav","metal/007_7.wav","metal/008_8.wav","metal/009_9.wav"],east:["east/000_nipon_wood_block.wav","east/001_ohkawa_mute.wav","east/002_ohkawa_open.wav","east/003_shime_hi.wav","east/004_shime_hi_2.wav","east/005_shime_mute.wav","east/006_taiko_1.wav","east/007_taiko_2.wav","east/008_taiko_3.wav"],space:["space/000_0.wav","space/001_1.wav","space/002_11.wav","space/003_12.wav","space/004_13.wav","space/005_14.wav","space/006_15.wav","space/007_16.wav","space/008_17.wav","space/009_18.wav","space/010_2.wav","space/011_3.wav","space/012_4.wav","space/013_5.wav","space/014_6.wav","space/015_7.wav","space/016_8.wav","space/017_9.wav"],numbers:["numbers/0.wav","numbers/1.wav","numbers/2.wav","numbers/3.wav","numbers/4.wav","numbers/5.wav","numbers/6.wav","numbers/7.wav","numbers/8.wav"]},"github:tidalcycles/dirt-samples",{prebake:!0})])}const ki=Nt("C8"),Si=(r,e)=>r*e+(1-e)/2;Mt.prototype.piano=function(){return this.fmap(r=>({...r,clip:r.clip??1})).s("piano").release(.1).fmap(r=>{const e=zt(r),t=Si(Math.min(Math.round(e)/ki,1),.5);return{...r,pan:(r.pan||1)*t}})};function We(r,e={}){let t=ue.useCallback(i=>e.keys?Yr(r,e.keys,i):r.listen(i),[e.keys,r]),s=r.get.bind(r);return ue.useSyncExternalStore(t,s,s)}const es="System Standard",Ei={activeFooter:"intro",keybindings:"codemirror",isBracketMatchingEnabled:!0,isBracketClosingEnabled:!0,isLineNumbersDisplayed:!0,isActiveLineHighlighted:!0,isAutoCompletionEnabled:!1,isTooltipEnabled:!1,isFlashEnabled:!0,isSyncEnabled:!1,isLineWrappingEnabled:!1,isPatternHighlightingEnabled:!0,theme:"strudelTheme",fontFamily:"monospace",fontSize:18,latestCode:"",isZen:!1,soundsFilter:"all",patternFilter:"community",panelPosition:"right",userPatterns:"{}",audioDeviceName:es},z=ys("strudel-settings",Ei),R=r=>!![!0,"true"].includes(r);function ja(){const r=We(z),e=JSON.parse(r.userPatterns);return Object.keys(e).forEach(t=>{const s=e[t];s.id=s.id??t,e[t]=s}),{...r,isZen:R(r.isZen),isBracketMatchingEnabled:R(r.isBracketMatchingEnabled),isBracketClosingEnabled:R(r.isBracketClosingEnabled),isLineNumbersDisplayed:R(r.isLineNumbersDisplayed),isActiveLineHighlighted:R(r.isActiveLineHighlighted),isAutoCompletionEnabled:R(r.isAutoCompletionEnabled),isPatternHighlightingEnabled:R(r.isPatternHighlightingEnabled),isTooltipEnabled:R(r.isTooltipEnabled),isLineWrappingEnabled:R(r.isLineWrappingEnabled),isFlashEnabled:R(r.isFlashEnabled),isSyncEnabled:R(r.isSyncEnabled),fontSize:Number(r.fontSize),panelPosition:r.activeFooter!==""?r.panelPosition:"bottom",userPatterns:e}}const Ra=r=>z.setKey("activeFooter",r),Ca=r=>z.setKey("isZen",!!r),Xe=r=>Kr(r,(e,t)=>t.onTrigger(()=>(e=Array.isArray(e)?e.join(" "):e,e!==z.get()[r]&&z.setKey(r,e),t),!1)),Ti=Xe("theme"),Oi=Xe("fontFamily"),Pi=Xe("fontSize"),Ai={theme:Ti,fontFamily:Oi,fontSize:Pi},$i=["by","url","genre","license"];function ji(r){const e=/\/\*([\s\S]*?)\*\/|\/\/(.*)$/gm,t=[...r.matchAll(e)].map(a=>(a[1]||a[2]||"").trim()),s={},[i,n]=(t[0]||"").split('"');i.trim()===""&&n!==void 0&&(s.title=n);for(const a of t){const o=a.split("@").slice(1);for(const c of o){let[l,h]=c.split(/ (.*)/s);if(l=l.trim(),h=(h||"").replaceAll(/ +/g," ").trim(),$i.includes(l)){const u=h.split(/[,\n]/).map(d=>d.trim()).filter(d=>d!=="");s[l]=l in s?s[l].concat(u):u}else h=h.replaceAll(/\s+/g," "),s[l]=l in s?s[l]+" "+h:h}}return s}function Ri(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ct(r,e=!1){const t=Ri(),s=`_${t}`;return Object.defineProperty(window,s,{value:i=>(e&&Reflect.deleteProperty(window,s),r?.(i)),writable:!1,configurable:!0}),t}async function Ci(r,e={}){return new Promise((t,s)=>{const i=ct(a=>{t(a),Reflect.deleteProperty(window,`_${n}`)},!0),n=ct(a=>{s(a),Reflect.deleteProperty(window,`_${i}`)},!0);window.__TAURI_IPC__({cmd:r,callback:i,error:n,...e})})}const ts=()=>window.__TAURI_IPC__!=null,xi=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>S(()=>Promise.resolve().then(()=>pe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Ye extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Ii extends Ye{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Li extends Ye{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Di extends Ye{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ui=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Fi{constructor(e,{headers:t={},customFetch:s}={}){this.url=e,this.headers=t,this.fetch=xi(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ui(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:a}=t;let o={},c;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));const l=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:c}).catch(f=>{throw new Ii(f)}),h=l.headers.get("x-relay-error");if(h&&h==="true")throw new Li(l);if(!l.ok)throw new Di(l);let u=((s=l.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),d;return u==="application/json"?d=yield l.json():u==="application/octet-stream"?d=yield l.blob():u==="multipart/form-data"?d=yield l.formData():d=yield l.text(),{data:d,error:null}}catch(i){return{data:null,error:i}}})}}var Ni=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ne=Ni();const Mi=ne.fetch,Ze=ne.fetch.bind(ne),ss=ne.Headers,zi=ne.Request,Bi=ne.Response,pe=Object.freeze(Object.defineProperty({__proto__:null,Headers:ss,Request:zi,Response:Bi,default:Ze,fetch:Mi},Symbol.toStringTag,{value:"Module"}));class qi{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ze:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var a,o,c;let l=null,h=null,u=null,d=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){const y=await n.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=y:h=JSON.parse(y))}const p=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),_=(o=n.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");p&&_&&_.length>1&&(u=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(l={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,u=null,d=406,f="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const p=await n.text();try{l=JSON.parse(p),Array.isArray(l)&&n.status===404&&(h=[],l=null,d=200,f="OK")}catch{n.status===404&&p===""?(d=204,f="No Content"):l={message:p}}if(l&&this.isMaybeSingle&&(!((c=l?.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,d=200,f="OK"),l&&this.shouldThrowOnError)throw l}return{error:l,data:h,count:u,status:d,statusText:f}});return this.shouldThrowOnError||(i=i.catch(n=>{var a,o,c;return{error:{message:`${(a=n?.name)!==null&&a!==void 0?a:"FetchError"}: ${n?.message}`,details:`${(o=n?.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=n?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}}class Ji extends qi{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:n=i}={}){const a=n?`${n}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const n=typeof i>"u"?"offset":`${i}.offset`,a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class se extends Ji{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=t.map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}class Vi{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let n=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new se({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new se({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:n=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((l,h)=>l.concat(Object.keys(h)),[]);if(c.length>0){const l=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",l.join(","))}}return new se({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new se({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new se({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Hi="1.9.0",Ki={"X-Client-Info":`postgrest-js/${Hi}`};class Qe{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ki),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new Vi(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Qe(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,count:i}={}){let n;const a=new URL(`${this.url}/rpc/${e}`);let o;s?(n="HEAD",Object.entries(t).forEach(([l,h])=>{a.searchParams.append(l,`${h}`)})):(n="POST",o=t);const c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new se({method:n,url:a,headers:c,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}const Gi="2.9.1",Wi={"X-Client-Info":`realtime-js/${Gi}`},Xi="1.0.0",rs=1e4,Yi=1e3;var ie;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ie||(ie={}));var $;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})($||($={}));var x;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(x||(x={}));var Ne;(function(r){r.websocket="websocket"})(Ne||(Ne={}));var V;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(V||(V={}));class is{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Zi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const c=s.decode(e.slice(a,a+n));a=a+n;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class xe{constructor(e,t,s={},i=rs){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var lt;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(lt||(lt={}));class le{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=le.syncState(this.state,i,n,a),this.pendingDiffs.forEach(c=>{this.state=le.syncDiff(this.state,c,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=le.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(n,(l,h)=>{a[l]||(c[l]=h)}),this.map(a,(l,h)=>{const u=n[l];if(u){const d=h.map(_=>_.presence_ref),f=u.map(_=>_.presence_ref),g=h.filter(_=>f.indexOf(_.presence_ref)<0),p=u.filter(_=>d.indexOf(_.presence_ref)<0);g.length>0&&(o[l]=g),p.length>0&&(c[l]=p)}else o[l]=h}),this.syncDiff(n,{joins:o,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,c)=>{var l;const h=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),h.length>0){const u=e[o].map(f=>f.presence_ref),d=h.filter(f=>u.indexOf(f.presence_ref)<0);e[o].unshift(...d)}s(o,h,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const h=c.map(u=>u.presence_ref);l=l.filter(u=>h.indexOf(u.presence_ref)<0),e[o]=l,i(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var k;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(k||(k={}));const ht=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,a)=>(n[a]=Qi(a,r,e,i),n),{})},Qi=(r,e,t,s)=>{const i=e.find(o=>o.name===r),n=i?.type,a=t[r];return n&&!s.includes(n)?ns(n,a):Me(a)},ns=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return rn(e,t)}switch(r){case k.bool:return en(e);case k.float4:case k.float8:case k.int2:case k.int4:case k.int8:case k.numeric:case k.oid:return tn(e);case k.json:case k.jsonb:return sn(e);case k.timestamp:return nn(e);case k.abstime:case k.date:case k.daterange:case k.int4range:case k.int8range:case k.money:case k.reltime:case k.text:case k.time:case k.timestamptz:case k.timetz:case k.tsrange:case k.tstzrange:return Me(e);default:return Me(e)}},Me=r=>r,en=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},tn=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},sn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},rn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>ns(e,o))}return r},nn=r=>typeof r=="string"?r.replace(" ","T"):r;var ut;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ut||(ut={}));var dt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(dt||(dt={}));var ft;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(ft||(ft={}));class et{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=$.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new xe(this,x.join,this.params,this.timeout),this.rejoinTimer=new is(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this._on(x.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new le(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));const o={},c={broadcast:n,presence:a,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(l=>l.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:l})=>{var h;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{const u=this.bindings.postgres_changes,d=(h=u?.length)!==null&&h!==void 0?h:0,f=[];for(let g=0;g<d;g++){const p=u[g],{filter:{event:_,schema:y,table:b,filter:T}}=p,v=l&&l[g];if(v&&v.event===_&&v.schema===y&&v.table===b&&v.filter===T)f.push(Object.assign(Object.assign({},p),{id:v.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,o={method:"POST",headers:{apikey:(s=this.socket.accessToken)!==null&&s!==void 0?s:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=t.timeout)!==null&&i!==void 0?i:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),l.receive("ok",()=>n("ok")),l.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=$.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(x.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new xe(this,x.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new xe(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:h}=x;if(s&&[o,c,l,h].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var g,p,_;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((_=(p=f.filter)===null||p===void 0?void 0:p.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===a}).map(f=>f.callback(d,s)):(n=this.bindings[a])===null||n===void 0||n.filter(f=>{var g,p,_,y,b,T;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const v=f.id,E=(g=f.filter)===null||g===void 0?void 0:g.event;return v&&((p=t.ids)===null||p===void 0?void 0:p.includes(v))&&(E==="*"||E?.toLocaleLowerCase()===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const v=(b=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return v==="*"||v===((T=t?.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const g=d.data,{schema:p,table:_,commit_timestamp:y,type:b,errors:T}=g;d=Object.assign(Object.assign({},{schema:p,table:_,commit_timestamp:y,eventType:b,new:{},old:{},errors:T}),this._getPayloadRecords(g))}f.callback(d,s)})}_isClosed(){return this.state===$.closed}_isJoined(){return this.state===$.joined}_isJoining(){return this.state===$.joining}_isLeaving(){return this.state===$.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&et.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(x.close,{},e)}_onError(e){this._on(x.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ht(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ht(e.columns,e.old_record)),t}}const an=()=>{},on=typeof WebSocket<"u";class cn{constructor(e,t){var s;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Wi,this.params={},this.timeout=rs,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=an,this.conn=null,this.sendBuffer=[],this.serializer=new Zi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>S(()=>Promise.resolve().then(()=>pe),void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Ne.websocket}`,t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t?.params)===null||s===void 0?void 0:s.apikey;i&&(this.accessToken=i),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t?.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new is(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(on){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new ln(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),S(()=>import("./browser.Bdhvn36h.js").then(e=>e.b),__vite__mapDeps([3,4])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ie.connecting:return V.Connecting;case ie.open:return V.Open;case ie.closing:return V.Closing;default:return V.Closed}}isConnected(){return this.connectionState()===V.Open}channel(e,t={config:{}}){const s=new et(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(x.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Xi}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:a}=t;(a&&a===this.pendingHeartbeatRef||i===n?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${a&&"("+a+")"||""}`,n),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(i,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(x.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Yi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class ln{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ie.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class tt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function P(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class hn extends tt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class pt extends tt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var un=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const as=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>S(()=>Promise.resolve().then(()=>pe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},dn=()=>un(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield S(()=>Promise.resolve().then(()=>pe),void 0)).Response:Response});var ae=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Ie=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),fn=(r,e)=>ae(void 0,void 0,void 0,function*(){const t=yield dn();r instanceof t?r.json().then(s=>{e(new hn(Ie(s),r.status||500))}).catch(s=>{e(new pt(Ie(s),s))}):e(new pt(Ie(r),r))}),pn=(r,e,t,s)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};function Pe(r,e,t,s,i,n){return ae(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,pn(e,s,i,n)).then(c=>{if(!c.ok)throw c;return s?.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>fn(c,o))})})}function ze(r,e,t,s){return ae(this,void 0,void 0,function*(){return Pe(r,"GET",e,t,s)})}function N(r,e,t,s,i){return ae(this,void 0,void 0,function*(){return Pe(r,"POST",e,s,i,t)})}function gn(r,e,t,s,i){return ae(this,void 0,void 0,function*(){return Pe(r,"PUT",e,s,i,t)})}function os(r,e,t,s,i){return ae(this,void 0,void 0,function*(){return Pe(r,"DELETE",e,s,i,t)})}var j=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const _n={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},gt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class mn{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=as(i)}uploadOrUpdate(e,t,s,i){return j(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},gt),i),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl)):(n=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const c=this._removeEmptyFolders(t),l=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:n,headers:o},a?.duplex?{duplex:a.duplex}:{})),u=yield h.json();return h.ok?{data:{path:c,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(n){if(P(n))return{data:null,error:n};throw n}})}upload(e,t,s){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return j(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:gt.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,h["cache-control"]=`max-age=${l.cacheControl}`,h["content-type"]=l.contentType);const u=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:h}),d=yield u.json();return u.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(c){if(P(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return j(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const s=yield N(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),i=new URL(this.url+s.url),n=i.searchParams.get("token");if(!n)throw new tt("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}update(e,t,s){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t){return j(this,void 0,void 0,function*(){try{return{data:yield N(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}copy(e,t){return j(this,void 0,void 0,function*(){try{return{data:{path:(yield N(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,s){return j(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield N(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s?.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(P(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return j(this,void 0,void 0,function*(){try{const i=yield N(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(P(i))return{data:null,error:i};throw i}})}download(e,t){return j(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield ze(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(P(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&i.push(c);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return j(this,void 0,void 0,function*(){try{return{data:yield os(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}list(e,t,s){return j(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},_n),t),{prefix:e||""});return{data:yield N(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(P(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const wn="2.5.5",vn={"X-Client-Info":`storage-js/${wn}`};var W=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class yn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},vn),t),this.fetch=as(s)}listBuckets(){return W(this,void 0,void 0,function*(){try{return{data:yield ze(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(P(e))return{data:null,error:e};throw e}})}getBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield ze(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return W(this,void 0,void 0,function*(){try{return{data:yield N(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return W(this,void 0,void 0,function*(){try{return{data:yield gn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}emptyBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield N(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield os(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}}class bn extends yn{constructor(e,t={},s){super(e,t,s)}from(e){return new mn(this.url,this.headers,e,this.fetch)}}const kn="2.39.1";let ce="";typeof Deno<"u"?ce="deno":typeof document<"u"?ce="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ce="react-native":ce="node";const Sn={"X-Client-Info":`supabase-js-${ce}/${kn}`};var En=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Tn=r=>{let e;return r?e=r:typeof fetch>"u"?e=Ze:e=fetch,(...t)=>e(...t)},On=()=>typeof Headers>"u"?ss:Headers,Pn=(r,e,t)=>{const s=Tn(t),i=On();return(n,a)=>En(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:r;let l=new i(a?.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(n,Object.assign(Object.assign({},a),{headers:l}))})};function An(r){return r.replace(/\/$/,"")}function $n(r,e){const{db:t,auth:s,realtime:i,global:n}=r,{db:a,auth:o,realtime:c,global:l}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),i),global:Object.assign(Object.assign({},l),n)}}function jn(r){return Math.round(Date.now()/1e3)+r}function Rn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const C=()=>typeof document<"u",B={tested:!1,writable:!1},he=()=>{if(!C())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(B.tested)return B.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),B.tested=!0,B.writable=!0}catch{B.tested=!0,B.writable=!1}return B.writable};function Le(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const cs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>S(()=>Promise.resolve().then(()=>pe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Cn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",q=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},be=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},De=async(r,e)=>{await r.removeItem(e)};function xn(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,n,a,o,c,l,h=0;for(r=r.replace("-","+").replace("_","/");h<r.length;)a=e.indexOf(r.charAt(h++)),o=e.indexOf(r.charAt(h++)),c=e.indexOf(r.charAt(h++)),l=e.indexOf(r.charAt(h++)),s=a<<2|o>>4,i=(o&15)<<4|c>>2,n=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&i!=0&&(t=t+String.fromCharCode(i)),l!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class Ae{constructor(){this.promise=new Ae.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ae.promiseConstructor=Promise;function _t(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(xn(s))}async function In(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Ln(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function Dn(r){return("0"+r.toString(16)).substr(-2)}function X(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,Dn).join("")}async function Un(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}function Fn(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Y(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Un(r);return Fn(t)}class st extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function m(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Nn extends st{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Mn(r){return m(r)&&r.name==="AuthApiError"}class ls extends st{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class K extends st{constructor(e,t,s){super(e),this.name=t,this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Z extends K{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Ue extends K{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class ke extends K{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Se extends K{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class mt extends K{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Be extends K{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Fe(r){return m(r)&&r.name==="AuthRetryableFetchError"}class zn extends K{constructor(e,t,s){super(e,"AuthWeakPasswordError",t),this.reasons=s}}var Bn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const re=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),qn=[502,503,504];async function wt(r){if(!Cn(r))throw new Be(re(r),0);if(qn.includes(r.status))throw new Be(re(r),r.status);let e;try{e=await r.json()}catch(t){throw new ls(re(t),t)}throw typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)?new zn(re(e),r.status,e.weak_password.reasons):new Nn(re(e),r.status||500)}const Jn=(r,e,t,s)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function w(r,e,t,s){var i;const n=Object.assign({},s?.headers);s?.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s?.query)!==null&&i!==void 0?i:{};s?.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Vn(r,e,t+o,{headers:n,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function Vn(r,e,t,s,i,n){const a=Jn(e,s,i,n);let o;try{o=await r(t,a)}catch(c){throw console.error(c),new Be(re(c),0)}if(o.ok||await wt(o),s?.noResolveJson)return o;try{return await o.json()}catch(c){await wt(c)}}function J(r){var e;let t=null;Wn(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=jn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function vt(r){const e=J(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function M(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Hn(r){return{data:r,error:null}}function Kn(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=Bn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Gn(r){return r}function Wn(r){return r.access_token&&r.refresh_token&&r.expires_in}var Xn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class Yn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=cs(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await w(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(m(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await w(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:M})}catch(s){if(m(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Xn(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s?.newEmail,delete i.newEmail),await w(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Kn,redirectTo:t?.redirectTo})}catch(t){if(m(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await w(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:M})}catch(t){if(m(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},h=await w(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Gn});if(h.error)throw h.error;const u=await h.json(),d=(a=h.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(g.split(";")[1].split("=")[1]);l[`${_}Page`]=p}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(m(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await w(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:M})}catch(t){if(m(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await w(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:M})}catch(s){if(m(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await w(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:M})}catch(s){if(m(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await w(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(m(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await w(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(m(t))return{data:null,error:t};throw t}}}const hs="2.62.0",Zn="http://localhost:9999",Qn="supabase.auth.token",ea={"X-Client-Info":`gotrue-js/${hs}`},yt=10,ta={getItem:r=>he()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{he()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{he()&&globalThis.localStorage.removeItem(r)}};function bt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function sa(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Q={debug:!!(globalThis&&he()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class us extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ra extends us{}async function ia(r,e,t){Q.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Q.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Q.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Q.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Q.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new ra(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Q.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}sa();const na={url:Zn,storageKey:Qn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ea,flowType:"implicit",debug:!1},oe=30*1e3,kt=3;async function St(r,e,t){return await t()}class fe{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=fe.nextInstanceID,fe.nextInstanceID+=1,this.instanceID>0&&C()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},na),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Yn({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=cs(i.fetch),this.lock=i.lock||St,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,i.lock?this.lock=i.lock:C()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=ia:this.lock=St,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:he()?this.storage=ta:(this.memoryStorage={},this.storage=bt(this.memoryStorage)):(this.memoryStorage={},this.storage=bt(this.memoryStorage)),C()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${hs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=C()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),s?.message==="Identity is already linked"||s?.message==="Identity is already linked to another user"?{error:s}:(await this._removeSession(),{error:s});const{session:i,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return m(e)?{error:e}:{error:new ls("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,s,i;try{await this._removeSession();let n;if("email"in e){const{email:h,password:u,options:d}=e;let f=null,g=null;if(this.flowType==="pkce"){const p=X();await q(this.storage,`${this.storageKey}-code-verifier`,p),f=await Y(p),g=p===f?"plain":"s256"}n=await w(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:h,password:u,data:(t=d?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:g},xform:J})}else if("phone"in e){const{phone:h,password:u,options:d}=e;n=await w(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(s=d?.data)!==null&&s!==void 0?s:{},channel:(i=d?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:J})}else throw new ke("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(m(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await w(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:vt})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await w(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:vt})}else throw new ke("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Ue}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(m(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await be(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/"),{data:n,error:a}=await w(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:J});return await De(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Ue}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,o=await w(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:J}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ue}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(m(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:c}=e;let l=null,h=null;if(this.flowType==="pkce"){const d=X();await q(this.storage,`${this.storageKey}-code-verifier`,d),l=await Y(d),h=d===l?"plain":"s256"}const{error:u}=await w(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:h}=await w(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:h}}throw new ke("You must provide either an email or phone number.")}catch(o){if(m(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await w(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:J});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(m(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{await this._removeSession();let n=null,a=null;if(this.flowType==="pkce"){const o=X();await q(this.storage,`${this.storageKey}-code-verifier`,o),n=await Y(o),a=o===n?"plain":"s256"}return await w(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:Hn})}catch(n){if(m(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Z;const{error:i}=await w(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(m(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await w(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:o}=await w(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new ke("You must provide either an email or phone number and a type")}catch(t){if(m(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await be(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s)return{data:{session:e},error:null};const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await w(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:M}):await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await w(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:M})})}catch(t){if(m(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new Z;const a=i.session;let o=null,c=null;if(this.flowType==="pkce"&&e.email!=null){const u=X();await q(this.storage,`${this.storageKey}-code-verifier`,u),o=await Y(u),c=u===o?"plain":"s256"}const{data:l,error:h}=await w(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:M});if(h)throw h;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(m(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return _t(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Z;const t=Date.now()/1e3;let s=t,i=!0,n=null;const a=_t(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(m(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new Z;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(m(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!C())throw new Se("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Se("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new mt("Not a valid PKCE flow url.");const t=Le(window.location.href);if(e){if(!t.code)throw new mt("No code detected.");const{data:b,error:T}=await this._exchangeCodeForSession(t.code);if(T)throw T;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:b.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Se(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=t;if(!n||!o||!a||!l)throw new Se("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(o);let d=h+u;c&&(d=parseInt(c));const f=d-h;f*1e3<=oe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=d-u;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,d,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",g,d,h);const{data:p,error:_}=await this._getUser(n);if(_)throw _;const y={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:u,expires_at:d,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(t){if(m(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Le(window.location.href);return!!(C()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Le(window.location.href),t=await be(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Mn(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await De(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Rn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;if(this.flowType==="pkce"){const n=X();await q(this.storage,`${this.storageKey}-code-verifier`,`${n}/PASSWORD_RECOVERY`),s=await Y(n),i=n===s?"plain":"s256"}try{return await w(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(m(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(m(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,o,c,l,h;const{data:u,error:d}=n;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await w(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return C()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(m(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await w(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(m(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Ln(async i=>(await In(i*200),this._debug(t,"refreshing attempt",i),await w(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:J})),(i,n,a)=>a&&a.error&&Fe(a.error)&&Date.now()+(i+1)*200-s<oe)}catch(s){if(this._debug(t,"error",s),m(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),C()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await be(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+yt;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${yt}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Fe(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Z;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ae;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new Z;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),m(n)){const a={session:null,error:n};return Fe(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){n.push(c)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await q(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await De(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&C()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),oe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/oe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${oe}ms, refresh threshold is ${kt} ticks`),i<=kt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof us)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!C()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const n=X();await q(this.storage,`${this.storageKey}-code-verifier`,n);const a=await Y(n),o=n===a?"plain":"s256";this._debug("PKCE","code verifier",`${n.substring(0,5)}...`,"code challenge",a,"method",o);const c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(c.toString())}if(s?.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await w(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(m(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:c}=await w(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(!((i=o?.totp)===null||i===void 0)&&i.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(m(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await w(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(m(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await w(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(m(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=e?.factors||[],i=s.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:s,totp:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(i.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const h=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}}fe.nextInstanceID=0;class aa extends fe{constructor(e){super(e)}}var oa=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{l(s.next(h))}catch(u){a(u)}}function c(h){try{l(s.throw(h))}catch(u){a(u)}}function l(h){h.done?n(h.value):i(h.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const ca={headers:Sn},la={schema:"public"},ha={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ua={};class da{constructor(e,t,s){var i,n,a,o,c,l,h,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=An(e);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,g={db:la,realtime:ua,auth:Object.assign(Object.assign({},ha),{storageKey:f}),global:ca},p=$n(s??{},g);this.storageKey=(n=(i=p.auth)===null||i===void 0?void 0:i.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=(a=p.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((c=p.auth)!==null&&c!==void 0?c:{},this.headers,(l=p.global)===null||l===void 0?void 0:l.fetch),this.fetch=Pn(t,this._getAccessToken.bind(this),(h=p.global)===null||h===void 0?void 0:h.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new Qe(`${d}/rest/v1`,{headers:this.headers,schema:(u=p.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Fi(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new bn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return oa(this,void 0,void 0,function*(){const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:a,debug:o},c,l){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new aa({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,debug:o,fetch:l})}_initRealtimeClient(e){return new cn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fa=(r,e,t)=>new da(r,e,t);let ds=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");async function pa(r){return Ci("tauri",r)}async function ga(r){return pa({__tauriModule:"Clipboard",message:{cmd:"writeText",data:r}})}let _a=Ge([]),fs=Ge([]);const ps={user:"user",public:"Last Creations",stock:"Stock Examples",featured:"Featured"},xa={community:"community",user:"user"},gs=(r,e=void 0)=>{const t=typeof sessionStorage<"u"?sessionStorage:{},s=Ge(typeof t[r]<"u"?t[r]:e);return s.listen(i=>{typeof i>"u"?delete t[r]:t[r]=i}),s};let rt=gs("viewingPatternData",{id:"",code:"",collection:ps.user,created_at:Date.now()});const Et=()=>nt(rt.get()),Ia=()=>We(rt),La=r=>{rt.set(JSON.stringify(r))};function ma(){return $e.from("code_v1").select().eq("public",!0).limit(20).order("id",{ascending:!1})}function wa(){return $e.from("code_v1").select().eq("featured",!0).limit(20).order("id",{ascending:!1})}async function va(){try{const{data:r}=await ma(),{data:e}=await wa(),t={},s={};r?.forEach((i,n)=>s[i.id??n]=i),e?.forEach((i,n)=>t[i.id??n]=i),_a.set(s),fs.set(t)}catch(r){console.error("error loading patterns",r)}}const it=gs("activePattern","");function Tt(r){it.set(r)}function ya(){return it.get()}function Da(){return We(it)}const Ua=r=>z.setKey("latestCode",r),Ot="",qe={collection:ps.user,getAll(){return nt(z.get().userPatterns)??{}},getPatternData(r){return this.getAll()[r]},exists(r){return this.getPatternData(r)!=null},isValidID(r){return r!=null&&r.length>0},create(){const r=ba(),t={code:Ot,created_at:Date.now(),id:r,collection:this.collection};return{id:r,data:t}},createAndAddToDB(){const r=this.create();return this.update(r.id,r.data)},update(r,e){const t=this.getAll();return e={...e,id:r,collection:this.collection},Oe({...t,[r]:e}),{id:r,data:e}},duplicate(r){const e=this.create();return this.update(e.id,{...e.data,code:r.code})},clearAll(){if(!confirm("This will delete all your patterns. Are you really sure?"))return;const r=Et();return Oe({}),r.collection!==this.collection?{id:r.id,data:r}:(Tt(null),this.create())},delete(r){const e=this.getAll();delete e[r],ya()===r&&Tt(null),Oe(e);const s=Et()?.id;return s===r?{id:null,data:{code:Ot}}:{id:s,data:e[s]}}};function Oe(r){return z.setKey("userPatterns",JSON.stringify(r))}const ba=()=>ds(12);async function Fa(r){const e=Array.from(r);await Promise.all(e.map(async(t,s)=>{const i=await t.text();if(t.type==="application/json"){const n=qe.getAll();Oe({...n,...nt(i)})}else if(t.type==="text/plain"){const n=t.name.replace(/\.[^/.]+$/,"");qe.update(n,{code:i})}})),A("import done!")}async function Na(){const r=qe.getAll(),e=new Blob([JSON.stringify(r)],{type:"application/json"}),t=document.createElement("a");t.href=window.URL.createObjectURL(e);const s=new Date().toISOString().split("T")[0];t.download=`strudel_patterns_${s}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}const $e=fa("https://pidxdsxphlhzjnzmifth.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpZHhkc3hwaGxoempuem1pZnRoIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTYyMzA1NTYsImV4cCI6MTk3MTgwNjU1Nn0.bqlw7802fsWRnqU5BLYtmXk_k-D1VFmbkHMywWc15NM");let _s;typeof window<"u"&&(_s=va());async function Ma(){try{const e=window.location.href.split("?")[1]?.split("#")?.[0]?.split("&")[0],t=window.location.href.split("#")[1]||"";if(t)return Wr(t);if(e)return $e.from("code_v1").select("code").eq("hash",e).then(({data:s,error:i})=>{if(i&&console.warn("failed to load hash",i),s.length)return s[0].code})}catch(r){console.warn("failed to decode",r)}}const nt=r=>{r=r!=null&&r.length?r:"{}";try{return JSON.parse(r)}catch{return"{}"}};async function za(){await _s;const r=Object.entries(fs.get()),e=i=>i[Math.floor(Math.random()*i.length)],[t,s]=e(r);return s}function Ba(){let r=[S(()=>import("./index.Dkgbun3A.js").then(e=>e.Q),__vite__mapDeps([])),S(()=>import("./index.jPZcmtW4.js"),__vite__mapDeps([5,1])),S(()=>import("./index.Bj5LU-in.js"),__vite__mapDeps([6,1,4])),S(()=>Promise.resolve().then(()=>Xr),void 0),S(()=>import("./index.6h12LIjg.js"),__vite__mapDeps([7,1])),S(()=>Promise.resolve().then(()=>ri),void 0),S(()=>Promise.resolve().then(()=>ii),void 0),S(()=>import("./hydra.DR7EVVgQ.js"),__vite__mapDeps([8,9,1,4])),S(()=>import("./serial.BPtmSo0r.js"),__vite__mapDeps([10,1])),S(()=>import("./index.vCJ-_cIy.js"),__vite__mapDeps([0,1,2])),S(()=>import("./index.kVeZ0DDY.js"),__vite__mapDeps([11,9,1,4,2])),S(()=>import("./tidal.D_bodmyB.js"),__vite__mapDeps([12,1,9,4]))];return ts()?r=r.concat([S(()=>import("./loggerbridge.kyr5zX5S.js"),__vite__mapDeps([13,1,9,4,2,14])),S(()=>import("./midibridge.DRyf-tQB.js"),__vite__mapDeps([15,16,1,9,4,2,14])),S(()=>import("./oscbridge.BcorbPHJ.js"),__vite__mapDeps([17,1,16,9,4,2,14]))]):r=r.concat([S(()=>import("./index.BH6n4fe0.js"),__vite__mapDeps([18,1])),S(()=>import("./osc.B4iWeLtK.js"),__vite__mapDeps([19,4,1]))]),Gr(Ai,...r)}let Pt;async function qa(r){if(Pt===r){A("Link already generated!","error");return}const e=confirm("Do you want your pattern to be public? If no, press cancel and you will get just a private link."),t=ds(12),s=window.location.origin+window.location.pathname+"?"+t,{error:i}=await $e.from("code_v1").insert([{code:r,hash:t,public:e}]);if(i){console.log("error",i);const n=`Error: ${i.message}`;A(n)}else{Pt=r,ts()?await ga(s):await navigator.clipboard.writeText(s);const n=`Link copied to clipboard: ${s}`;alert(n),A(n,"highlight")}}const Ja=ue.createContext(null),Va=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let r=await navigator.mediaDevices.enumerateDevices();r=r.filter(t=>t.kind==="audiooutput"&&t.deviceId!=="default");const e=new Map;return e.set(es,""),r.forEach(t=>{e.set(t.label,t.deviceId)}),e},Ha=async r=>{let e=I();if(e.sinkId===r)return;if(await e.suspend(),await e.close(),e=Dt(),await e.resume(),(r??"").length>0)try{await e.setSinkId(r)}catch{A("failed to set audio interface","warning")}Ut()};function Ka(r){try{const e=ji(r);Ft(e.version)}catch(e){console.error("Error parsing metadata.."),console.error(e)}}function Ga(){const[r,e]=ue.useState(!1);return ue.useEffect(()=>{e(!0)},[]),r}export{fs as $,Pa as A,Va as B,Ha as C,Ei as D,Aa as E,_i as F,mi as G,ds as H,Ra as I,Ua as J,Et as K,La as L,ba as M,Tt as N,Ma as O,za as P,es as Q,Ja as R,qa as S,wa as a,pa as b,_a as c,ps as d,Da as e,Ia as f,ji as g,ja as h,Ci as i,xa as j,qe as k,ma as l,Fa as m,Na as n,$a as o,nt as p,Ba as q,Ka as r,z as s,ct as t,We as u,Ga as v,Ca as w,ai as x,de as y,Yt as z};
