/**
 * @license Fraction.js v4.3.7 31/08/2023
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2023, Robert Eisele (robert@raw.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/var ea=2e3,w={s:1,n:0,d:1};function ut(e,t){if(isNaN(e=parseInt(e,10)))throw $t();return e*t}function z(e,t){if(t===0)throw Yt();var n=Object.create(S.prototype);n.s=e<0?-1:1,e=e<0?-e:e;var s=wt(e,t);return n.n=e/s,n.d=t/s,n}function Se(e){for(var t={},n=e,s=2,r=4;r<=n;){for(;n%s===0;)n/=s,t[s]=(t[s]||0)+1;r+=1+2*s++}return n!==e?n>1&&(t[n]=(t[n]||0)+1):t[e]=(t[e]||0)+1,t}var U=function(e,t){var n=0,s=1,r=1,o=0,i=0,a=0,u=1,f=1,l=0,h=1,y=1,p=1,_=1e7,b;if(e!=null)if(t!==void 0){if(n=e,s=t,r=n*s,n%1!==0||s%1!==0)throw oa()}else switch(typeof e){case"object":{if("d"in e&&"n"in e)n=e.n,s=e.d,"s"in e&&(n*=e.s);else if(0 in e)n=e[0],1 in e&&(s=e[1]);else throw $t();r=n*s;break}case"number":{if(e<0&&(r=e,e=-e),e%1===0)n=e;else if(e>0){for(e>=1&&(f=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)),e/=f);h<=_&&p<=_;)if(b=(l+y)/(h+p),e===b){h+p<=_?(n=l+y,s=h+p):p>h?(n=y,s=p):(n=l,s=h);break}else e>b?(l+=y,h+=p):(y+=l,p+=h),h>_?(n=y,s=p):(n=l,s=h);n*=f}else(isNaN(e)||isNaN(t))&&(s=n=NaN);break}case"string":{if(h=e.match(/\d+|./g),h===null)throw $t();if(h[l]==="-"?(r=-1,l++):h[l]==="+"&&l++,h.length===l+1?i=ut(h[l++],r):h[l+1]==="."||h[l]==="."?(h[l]!=="."&&(o=ut(h[l++],r)),l++,(l+1===h.length||h[l+1]==="("&&h[l+3]===")"||h[l+1]==="'"&&h[l+3]==="'")&&(i=ut(h[l],r),u=Math.pow(10,h[l].length),l++),(h[l]==="("&&h[l+2]===")"||h[l]==="'"&&h[l+2]==="'")&&(a=ut(h[l+1],r),f=Math.pow(10,h[l+1].length)-1,l+=3)):h[l+1]==="/"||h[l+1]===":"?(i=ut(h[l],r),u=ut(h[l+2],1),l+=3):h[l+3]==="/"&&h[l+1]===" "&&(o=ut(h[l],r),i=ut(h[l+2],r),u=ut(h[l+4],1),l+=5),h.length<=l){s=u*f,r=n=a+s*o+f*i;break}}default:throw $t()}if(s===0)throw Yt();w.s=r<0?-1:1,w.n=Math.abs(n),w.d=Math.abs(s)};function na(e,t,n){for(var s=1;t>0;e=e*e%n,t>>=1)t&1&&(s=s*e%n);return s}function sa(e,t){for(;t%2===0;t/=2);for(;t%5===0;t/=5);if(t===1)return 0;for(var n=10%t,s=1;n!==1;s++)if(n=n*10%t,s>ea)return 0;return s}function ra(e,t,n){for(var s=1,r=na(10,n,t),o=0;o<300;o++){if(s===r)return o;s=s*10%t,r=r*10%t}return 0}function wt(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function S(e,t){if(U(e,t),this instanceof S)e=wt(w.d,w.n),this.s=w.s,this.n=w.n/e,this.d=w.d/e;else return z(w.s*w.n,w.d)}var Yt=function(){return new Error("Division by Zero")},$t=function(){return new Error("Invalid argument")},oa=function(){return new Error("Parameters must be integer")};S.prototype={s:1,n:0,d:1,abs:function(){return z(this.n,this.d)},neg:function(){return z(-this.s*this.n,this.d)},add:function(e,t){return U(e,t),z(this.s*this.n*w.d+w.s*this.d*w.n,this.d*w.d)},sub:function(e,t){return U(e,t),z(this.s*this.n*w.d-w.s*this.d*w.n,this.d*w.d)},mul:function(e,t){return U(e,t),z(this.s*w.s*this.n*w.n,this.d*w.d)},div:function(e,t){return U(e,t),z(this.s*w.s*this.n*w.d,this.d*w.n)},clone:function(){return z(this.s*this.n,this.d)},mod:function(e,t){if(isNaN(this.n)||isNaN(this.d))return new S(NaN);if(e===void 0)return z(this.s*this.n%this.d,1);if(U(e,t),w.n===0&&this.d===0)throw Yt();return z(this.s*(w.d*this.n)%(w.n*this.d),w.d*this.d)},gcd:function(e,t){return U(e,t),z(wt(w.n,this.n)*wt(w.d,this.d),w.d*this.d)},lcm:function(e,t){return U(e,t),w.n===0&&this.n===0?z(0,1):z(w.n*this.n,wt(w.n,this.n)*wt(w.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new S(NaN):z(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new S(NaN):z(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new S(NaN):z(Math.round(e*this.s*this.n/this.d),e)},roundTo:function(e,t){return U(e,t),z(this.s*Math.round(this.n*w.d/(this.d*w.n))*w.n,w.d)},inverse:function(){return z(this.s*this.d,this.n)},pow:function(e,t){if(U(e,t),w.d===1)return w.s<0?z(Math.pow(this.s*this.d,w.n),Math.pow(this.n,w.n)):z(Math.pow(this.s*this.n,w.n),Math.pow(this.d,w.n));if(this.s<0)return null;var n=Se(this.n),s=Se(this.d),r=1,o=1;for(var i in n)if(i!=="1"){if(i==="0"){r=0;break}if(n[i]*=w.n,n[i]%w.d===0)n[i]/=w.d;else return null;r*=Math.pow(i,n[i])}for(var i in s)if(i!=="1"){if(s[i]*=w.n,s[i]%w.d===0)s[i]/=w.d;else return null;o*=Math.pow(i,s[i])}return w.s<0?z(o,r):z(r,o)},equals:function(e,t){return U(e,t),this.s*this.n*w.d===w.s*w.n*this.d},compare:function(e,t){U(e,t);var n=this.s*this.n*w.d-w.s*w.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;e=e||.001;for(var t=this.abs(),n=t.toContinued(),s=1;s<n.length;s++){for(var r=z(n[s-1],1),o=s-2;o>=0;o--)r=r.inverse().add(n[o]);if(Math.abs(r.sub(t).valueOf())<e)return r.mul(this.s)}return this},divisible:function(e,t){return U(e,t),!(!(w.n*this.d)||this.n*w.d%(w.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,n+=" ",s%=r),n+=s,n+="/",n+=r),n},toLatex:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,s%=r),n+="\\frac{",n+=s,n+="}{",n+=r,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,s=[];if(isNaN(t)||isNaN(n))return s;do s.push(Math.floor(t/n)),e=t%n,t=n,n=e;while(t!==1);return s},toString:function(e){var t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";e=e||15;var s=sa(t,n),r=ra(t,n,s),o=this.s<0?"-":"";if(o+=t/n|0,t%=n,t*=10,t&&(o+="."),s){for(var i=r;i--;)o+=t/n|0,t%=n,t*=10;o+="(";for(var i=s;i--;)o+=t/n|0,t%=n,t*=10;o+=")"}else for(var i=e;t&&i--;)o+=t/n|0,t%=n,t*=10;return o}};const Zt="strudel.log";let ia=1e3,Ne,Oe;function W(e,t,n={}){let s=performance.now();Ne===e&&s-Oe<ia||(Ne=e,Oe=s,console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(Zt,{detail:{message:e,type:t,data:n}})))}W.key=Zt;const ca=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),Rt=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),Re=e=>{if(typeof e!="string")return[];const[t,n="",s]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,s?Number(s):void 0]:[]},aa={c:0,d:2,e:4,f:5,g:7,a:9,b:11},ua={"#":1,b:-1,s:1,f:-1},kt=(e,t=3)=>{const[n,s,r=t]=Re(e);if(!n)throw new Error('not a note: "'+e+'"');const o=aa[n.toLowerCase()],i=s?.split("").reduce((a,u)=>a+ua[u],0)||0;return(Number(r)+1)*12+o+i},mt=e=>Math.pow(2,(e-69)/12)*440,te=e=>12*Math.log(e/440)/Math.LN2+69,la=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;if(typeof n=="number")return te(n);if(typeof s=="string")return kt(s);if(typeof s=="number")return s;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},fa=(e,t)=>(e-t)*1e3,Je=e=>mt(typeof e=="number"?e:kt(e)),ha=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],da=e=>{const t=Math.floor(e/12)-1;return ha[e%12]+t},Ot=(e,t)=>(e%t+t)%t;function Le(e,t=0){return isNaN(Number(e))?(W(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const pa=(e,t)=>Ot(Math.round(Le(e??0,0)),t),ma=e=>{let{value:t,context:n}=e,s=t;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof s=="number"&&n.type!=="frequency")s=mt(e.value);else if(typeof s=="number"&&n.type==="frequency")s=e.value;else if(typeof s!="string"||!Rt(s))throw new Error("not a note: "+JSON.stringify(s));return s},Ie=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:Je(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=mt(e.value);else if(typeof t=="string"&&Rt(t))t=mt(kt(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},We=(e,t)=>e.slice(t).concat(e.slice(0,t)),He=(...e)=>e.reduce((t,n)=>(...s)=>t(n(...s)),t=>t),ya=(...e)=>He(...e.reverse()),qt=e=>e.filter(t=>t!=null),ft=e=>[].concat(...e),bt=e=>e,ga=(e,t)=>e,ee=(e,t)=>Array.from({length:t-e+1},(n,s)=>s+e);function A(e,t,n=e.length){const s=function r(...o){if(o.length>=n)return e.apply(this,o);{const i=function(...a){return r.apply(this,o.concat(a))};return t&&t(i,o),i}};return t&&t(s,[]),s}function ne(e){const t=Number(e);if(!isNaN(t))return t;if(Rt(e))return kt(e);throw new Error(`cannot parse as numeral: "${e}"`)}function se(e,t){return(...n)=>e(...n.map(t))}function K(e){return se(e,ne)}function De(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const wa=e=>se(e,De),re=function(e,t){return[t.slice(0,e),t.slice(e)]},oe=(e,t,n)=>t.map((s,r)=>e(s,n[r])),Ve=function(e){const t=[];for(let n=0;n<e.length-1;++n)t.push([e[n],e[n+1]]);return t},Qe=(e,t,n)=>Math.min(Math.max(e,t),n),ba=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],va=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],_a=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],ka=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],qa=["I","Ro","Ha","Ni","Ho","He","To"],Aa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ta=(e,t="letters")=>{const s=(t==="solfeggio"?ba:t==="indian"?va:t==="german"?_a:t==="byzantine"?ka:t==="japanese"?qa:Aa)[e%12],r=Math.floor(e/12)-1;return s+r};function Ca(e){var t={};return e.filter(function(n){return t.hasOwn(n)?!1:t[n]=!0})}function Ma(e){return e.sort().filter(function(t,n,s){return!n||t!=s[n-1]})}function Ge(e){return e.sort((t,n)=>t.compare(n)).filter(function(t,n,s){return!n||t.ne(s[n-1])})}function Ue(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Ke(e){const t=new Uint8Array(atob(e).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(t)}function Sa(e){return encodeURIComponent(Ue(e))}function Na(e){return Ke(decodeURIComponent(e))}function Xe(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map(([n,s],r)=>[n,t(s,n,r)]))}S.prototype.sam=function(){return this.floor()};S.prototype.nextSam=function(){return this.sam().add(1)};S.prototype.wholeCycle=function(){return new F(this.sam(),this.nextSam())};S.prototype.cyclePos=function(){return this.sub(this.sam())};S.prototype.lt=function(e){return this.compare(e)<0};S.prototype.gt=function(e){return this.compare(e)>0};S.prototype.lte=function(e){return this.compare(e)<=0};S.prototype.gte=function(e){return this.compare(e)>=0};S.prototype.eq=function(e){return this.compare(e)==0};S.prototype.ne=function(e){return this.compare(e)!=0};S.prototype.max=function(e){return this.gt(e)?this:e};S.prototype.maximum=function(...e){return e=e.map(t=>new S(t)),e.reduce((t,n)=>n.max(t),this)};S.prototype.min=function(e){return this.lt(e)?this:e};S.prototype.mulmaybe=function(e){return e!==void 0?this.mul(e):void 0};S.prototype.divmaybe=function(e){return e!==void 0?this.div(e):void 0};S.prototype.addmaybe=function(e){return e!==void 0?this.add(e):void 0};S.prototype.submaybe=function(e){return e!==void 0?this.sub(e):void 0};S.prototype.show=function(){return this.s*this.n+"/"+this.d};S.prototype.or=function(e){return this.eq(0)?e:this};const g=e=>S(e),Oa=(...e)=>{if(e=qt(e),e.length!==0)return e.reduce((t,n)=>t.gcd(n),g(1))},Bt=(...e)=>{if(e=qt(e),e.length!==0)return e.reduce((t,n)=>t===void 0||n===void 0?void 0:t.lcm(n),g(1))};g._original=S;class F{constructor(t,n){this.begin=g(t),this.end=g(n)}get spanCycles(){const t=[];var n=this.begin;const s=this.end,r=s.sam();if(n.equals(s))return[new F(n,s)];for(;s.gt(n);){if(n.sam().equals(r)){t.push(new F(n,this.end));break}const o=n.nextSam();t.push(new F(n,o)),n=o}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new F(t,n)}withTime(t){return new F(t(this.begin),t(this.end))}withEnd(t){return new F(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),s=n.add(t(this.begin.sub(n))),r=n.add(t(this.end.sub(n)));return new F(s,r)}intersection(t){const n=this.begin.max(t.begin),s=this.end.min(t.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new F(n,s)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(g(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class ${constructor(t,n,s,r={},o=!1){this.whole=t,this.part=n,this.value=s,this.context=r,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let t;return typeof this.value?.duration=="number"?t=g(this.value.duration):t=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?t.mul(this.value.clip):t}get endClipped(){return this.whole.begin.add(this.duration)}isActive(t){return this.whole.begin<=t&&this.endClipped>=t}isInPast(t){return t>this.endClipped}isInNearPast(t,n){return n-t<=this.endClipped}isInFuture(t){return t<this.whole.begin}isInNearFuture(t,n){return n<this.whole.begin&&n>this.whole.begin-t}isWithinTime(t,n){return this.whole.begin<=n&&this.endClipped>=t}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new $(n,t(this.part),this.value,this.context)}withValue(t){return new $(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(t){return this.context.tags?.includes(t)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,r]=n(t);return[s,new $(this.whole,this.part,r,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var r=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),r||(s+="("),s+=this.part.show(),r||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new $(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class _t{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new _t(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new _t(this.span,t)}}function Ba(e,t,n){if(t?.value!==void 0&&Object.keys(t).length===1)return W("[warn]: Can't do arithmetic on control pattern."),e;const s=Object.keys(e).filter(r=>Object.keys(t).includes(r));return Object.assign({},e,t,Object.fromEntries(s.map(r=>[r,n(e[r],t[r])])))}A((e,t)=>e*t);A((e,t)=>t.map(e));function Ye(e,t=60){let n=0,s=g(0),r=[""],o="";for(;r[0].length<t;){const i=e.queryArc(n,n+1),a=i.filter(l=>l.hasOnset()).map(l=>l.duration),u=Oa(...a),f=u.inverse();r=r.map(l=>l+"|"),o+="|";for(let l=0;l<f;l++){const[h,y]=[s,s.add(u)],p=i.filter(b=>b.whole.begin.lte(h)&&b.whole.end.gte(y)),_=p.length-r.length;_>0&&(r=r.concat(Array(_).fill(o))),r=r.map((b,q)=>{const k=p[q];if(k){const E=k.whole.begin.eq(h)?""+k.value:"-";return b+E}return b+"."}),o+=".",s=s.add(u)}n++}return r.join(`
`)}let Dt,et=!0;const Pa=function(e){et=!!e},za=e=>Dt=e;class m{constructor(t,n=void 0){this.query=t,this._Pattern=!0,this.tactus=n}get tactus(){return this.__tactus}set tactus(t){this.__tactus=t===void 0?void 0:g(t)}setTactus(t){return this.tactus=t,this}withTactus(t){return et?new m(this.query,this.tactus===void 0?void 0:t(this.tactus)):this}get hasTactus(){return this.tactus!==void 0}withValue(t){const n=new m(s=>this.query(s).map(r=>r.withValue(t)));return n.tactus=this.tactus,n}fmap(t){return this.withValue(t)}appWhole(t,n){const s=this,r=function(o){const i=s.query(o),a=n.query(o),u=function(f,l){const h=f.part.intersection(l.part);if(h!=null)return new $(t(f.whole,l.whole),h,f.value(l.value),l.combineContext(f))};return ft(i.map(f=>qt(a.map(l=>u(f,l)))))};return new m(r)}appBoth(t){const n=this,s=function(o,i){if(!(o==null||i==null))return o.intersection_e(i)},r=n.appWhole(s,t);return et&&(r.tactus=Bt(t.tactus,n.tactus)),r}appLeft(t){const n=this,s=function(o){const i=[];for(const a of n.query(o)){const u=t.query(o.setSpan(a.wholeOrPart()));for(const f of u){const l=a.whole,h=a.part.intersection(f.part);if(h){const y=a.value(f.value),p=f.combineContext(a),_=new $(l,h,y,p);i.push(_)}}}return i},r=new m(s);return r.tactus=this.tactus,r}appRight(t){const n=this,s=function(o){const i=[];for(const a of t.query(o)){const u=n.query(o.setSpan(a.wholeOrPart()));for(const f of u){const l=a.whole,h=f.part.intersection(a.part);if(h){const y=f.value(a.value),p=a.combineContext(f),_=new $(l,h,y,p);i.push(_)}}}return i},r=new m(s);return r.tactus=t.tactus,r}bindWhole(t,n){const s=this,r=function(o){const i=function(u,f){return new $(t(u.whole,f.whole),f.part,f.value,Object.assign({},u.context,f.context,{locations:(u.context.locations||[]).concat(f.context.locations||[])}))},a=function(u){return n(u.value).query(o.setSpan(u.part)).map(f=>i(u,f))};return ft(s.query(o).map(u=>a(u)))};return new m(r)}bind(t){const n=function(s,r){if(!(s==null||r==null))return s.intersection_e(r)};return this.bindWhole(n,t)}join(){return this.bind(bt)}outerBind(t){return this.bindWhole(n=>n,t).setTactus(this.tactus)}outerJoin(){return this.outerBind(bt)}innerBind(t){return this.bindWhole((n,s)=>s,t)}innerJoin(){return this.innerBind(bt)}resetJoin(t=!1){const n=this;return new m(s=>n.discreteOnly().query(s).map(r=>r.value.late(t?r.whole.begin:r.whole.begin.cyclePos()).query(s).map(o=>new $(o.whole?o.whole.intersection(r.whole):void 0,o.part.intersection(r.part),o.value).setContext(r.combineContext(o))).filter(o=>o.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const t=this;function n(s){const r=t.discreteOnly().query(s);function o(a){const f=a.value._focusSpan(a.wholeOrPart()).query(s.setSpan(a.part));function l(h,y){let p;if(y.whole&&h.whole&&(p=y.whole.intersection(h.whole),!p))return;const _=y.part.intersection(h.part);if(!_)return;const b=y.combineContext(h);return new $(p,_,y.value,b)}return f.map(h=>l(a,h))}return ft(r.map(o)).filter(a=>a)}return new m(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}queryArc(t,n,s={}){try{return this.query(new _t(new F(t,n),s))}catch(r){return W(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const t=this,n=s=>ft(s.span.spanCycles.map(r=>t.query(s.setSpan(r))));return new m(n)}withQuerySpan(t){return new m(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new m(s=>{const r=s.withSpan(t);return r.span?n.query(r):[]})}withQueryTime(t){return new m(n=>this.query(n.withSpan(s=>s.withTime(t))))}withHapSpan(t){return new m(n=>this.query(n).map(s=>s.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){const n=new m(s=>t(this.query(s),s));return n.tactus=this.tactus,n}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){const n=this.withHap(s=>s.setContext(t(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const s={start:t,end:n},r=this.withContext(o=>{const i=(o.locations||[]).concat([s]);return{...o,locations:i}});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=s),r}filterHaps(t){return new m(n=>this.query(n).filter(t))}filterValues(t){return new m(n=>this.query(n).filter(s=>t(s.value))).setTactus(this.tactus)}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var r=0;r<n.length;++r){for(var o=!0,i=n[r];o;){const f=JSON.stringify(n[r].value);for(var a=!1,u=r+1;u<n.length;u++){const l=n[u];if(i.whole.equals(l.whole)){if(i.part.begin.eq(l.part.end)){if(f===JSON.stringify(l.value)){i=new $(i.whole,new F(l.part.begin,i.part.end),i.value),n.splice(u,1),a=!0;break}}else if(l.part.begin.eq(i.part.end)&&f==JSON.stringify(l.value)){i=new $(i.whole,new F(i.part.begin,l.part.end),i.value),n.splice(u,1),a=!0;break}}}o=a}s.push(i)}return s})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new _t(new F(g(0),g(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(ne)}_opIn(t,n){return this.fmap(n).appLeft(v(t))}_opOut(t,n){return this.fmap(n).appRight(v(t))}_opMix(t,n){return this.fmap(n).appBoth(v(t))}_opSqueeze(t,n){const s=v(t);return this.fmap(r=>s.fmap(o=>n(r)(o))).squeezeJoin()}_opSqueezeOut(t,n){const s=this;return v(t).fmap(o=>s.fmap(i=>n(i)(o))).squeezeJoin()}_opReset(t,n){return v(t).fmap(r=>this.fmap(o=>n(o)(r))).resetJoin()}_opRestart(t,n){return v(t).fmap(r=>this.fmap(o=>n(o)(r))).restartJoin()}layer(...t){return R(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return R(this,...t)}sequence(...t){return rt(this,...t)}seq(...t){return rt(this,...t)}cat(...t){return nn(this,...t)}fastcat(...t){return it(this,...t)}slowcat(...t){return yt(this,...t)}onTrigger(t,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...r)=>{s.context.onTrigger?.(...r),t(...r)},dominantTrigger:s.context.dominantTrigger||n}))}log(t=(s,r)=>`[hap] ${r.showWhole(!0)}`,n=(s,r)=>({hap:r})){return this.onTrigger((...s)=>{W(t(...s),void 0,n(...s))},!1)}logValues(t=bt){return this.log((n,s)=>t(s.value))}drawLine(){return console.log(Ye(this)),this}}function Ea(e,t){let n=[];return t.forEach(s=>{const r=n.findIndex(([o])=>e(s,o));r===-1?n.push([s]):n[r].push(s)}),n}const xa=(e,t)=>e.spanEquals(t);m.prototype.collect=function(){return this.withHaps(e=>Ea(xa,e).map(t=>new $(t[0].whole,t[0].part,t,{})))};m.prototype.arpWith=function(e){return this.collect().fmap(t=>v(e(t))).innerJoin().withHap(t=>new $(t.whole,t.part,t.value.value,t.combineContext(t.value)))};m.prototype.arp=function(e){return this.arpWith(t=>e.fmap(n=>t[n%t.length]))};function jt(e){return!Array.isArray(e)&&typeof e=="object"}function ja(e,t,n){return jt(e)||jt(t)?(jt(e)||(e={value:e}),jt(t)||(t={value:t}),Ba(e,t,n)):n(e,t)}(function(){const e={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[K((n,s)=>n+s)],sub:[K((n,s)=>n-s)],mul:[K((n,s)=>n*s)],div:[K((n,s)=>n/s)],mod:[K(Ot)],pow:[K(Math.pow)],band:[K((n,s)=>n&s)],bor:[K((n,s)=>n|s)],bxor:[K((n,s)=>n^s)],blshift:[K((n,s)=>n<<s)],brshift:[K((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart"];for(const[n,[s,r]]of Object.entries(e)){m.prototype["_"+n]=function(o){return this.fmap(i=>s(i,o))},Object.defineProperty(m.prototype,n,{get:function(){const o=this,i=(...a)=>o[n].in(...a);for(const a of t)i[a.toLowerCase()]=function(...u){var f=o;u=rt(u),r&&(f=r(f),u=r(u));var l;return n==="keepif"?(l=f["_op"+a](u,h=>y=>s(h,y)),l=l.removeUndefineds()):l=f["_op"+a](u,h=>y=>ja(h,y,s)),l};return i.squeezein=i.squeeze,i}});for(const o of t)m.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}m.prototype.struct=function(...n){return this.keepif.out(...n)},m.prototype.structAll=function(...n){return this.keep.out(...n)},m.prototype.mask=function(...n){return this.keepif.in(...n)},m.prototype.maskAll=function(...n){return this.keep.in(...n)},m.prototype.reset=function(...n){return this.keepif.reset(...n)},m.prototype.resetAll=function(...n){return this.keep.reset(...n)},m.prototype.restart=function(...n){return this.keepif.restart(...n)},m.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const $a=R,Fa=R,Ra=he,At=e=>new m(()=>[],e),P=At(1),X=At(0);function ot(e){function t(s){return s.span.spanCycles.map(r=>new $(g(r.begin).wholeCycle(),r,e))}const n=new m(t,1);return n.__pure=e,n}function ie(e){return e instanceof m||e?._Pattern}function v(e){return ie(e)?e:Dt&&typeof e=="string"?Dt(e):ot(e)}function R(...e){e=e.map(s=>Array.isArray(s)?rt(...s):v(s));const t=s=>ft(e.map(r=>r.query(s))),n=new m(t);return et&&(n.tactus=Bt(...e.map(s=>s.tactus))),n}function ce(e,t){if(t=t.map(o=>Array.isArray(o)?rt(...o):v(o)),t.length===0)return P;if(t.length===1)return t[0];const[n,...s]=t.map(o=>o.tactus),r=et?n.maximum(...s):void 0;return R(...e(r,t))}function Ze(...e){return ce((t,n)=>n.map(s=>s.tactus.eq(t)?s:Y(s,At(t.sub(s.tactus)))),e)}function tn(...e){return ce((t,n)=>n.map(s=>s.tactus.eq(t)?s:Y(At(t.sub(s.tactus)),s)),e)}function en(...e){return ce((t,n)=>n.map(s=>{if(s.tactus.eq(t))return s;const r=At(t.sub(s.tactus).div(2));return Y(r,s,r)}),e)}function Ja(e,...t){const[n,...s]=t.map(i=>i.tactus),r=n.maximum(...s),o={centre:en,left:Ze,right:tn,expand:R,repeat:(...i)=>un(r,...i)};return e.inhabit(o).fmap(i=>i(...t)).innerJoin().setTactus(r)}function yt(...e){if(e=e.map(s=>Array.isArray(s)?it(...s):v(s)),e.length==1)return e[0];const t=function(s){const r=s.span,o=Ot(r.begin.sam(),e.length),i=e[o];if(!i)return[];const a=r.begin.floor().sub(r.begin.div(e.length).floor());return i.withHapTime(u=>u.add(a)).query(s.setSpan(r.withTime(u=>u.sub(a))))},n=et?Bt(...e.map(s=>s.tactus)):void 0;return new m(t).splitQueries().setTactus(n)}function ae(...e){e=e.map(v);const t=function(n){const s=Math.floor(n.span.begin)%e.length;return e[s]?.query(n)||[]};return new m(t).splitQueries()}function nn(...e){return yt(...e)}function La(...e){const t=e.reduce((n,[s])=>n+s,0);return e=e.map(([n,s])=>[n,s.fast(n)]),Y(...e).slow(t)}function it(...e){let t=yt(...e);return e.length>1&&(t=t._fast(e.length),t.tactus=e.length),t}function rt(...e){return it(...e)}function sn(...e){return it(...e)}function Vt(e){return Array.isArray(e)?e.length==0?[P,0]:e.length==1?Vt(e[0]):[it(...e.map(t=>Vt(t)[0])),e.length]:[v(e),1]}const Ia=A((e,t)=>v(t).mask(e)),Wa=A((e,t)=>v(t).struct(e)),Ha=A((e,t)=>v(t).superimpose(...e)),Da=A((e,t)=>v(t).set(e)),Va=A((e,t)=>v(t).keep(e)),Qa=A((e,t)=>v(t).keepif(e)),Ga=A((e,t)=>v(t).add(e)),Ua=A((e,t)=>v(t).sub(e)),Ka=A((e,t)=>v(t).mul(e)),Xa=A((e,t)=>v(t).div(e)),Ya=A((e,t)=>v(t).mod(e)),Za=A((e,t)=>v(t).pow(e)),tu=A((e,t)=>v(t).band(e)),eu=A((e,t)=>v(t).bor(e)),nu=A((e,t)=>v(t).bxor(e)),su=A((e,t)=>v(t).blshift(e)),ru=A((e,t)=>v(t).brshift(e)),ou=A((e,t)=>v(t).lt(e)),iu=A((e,t)=>v(t).gt(e)),cu=A((e,t)=>v(t).lte(e)),au=A((e,t)=>v(t).gte(e)),uu=A((e,t)=>v(t).eq(e)),lu=A((e,t)=>v(t).eqt(e)),fu=A((e,t)=>v(t).ne(e)),hu=A((e,t)=>v(t).net(e)),du=A((e,t)=>v(t).and(e)),pu=A((e,t)=>v(t).or(e)),mu=A((e,t)=>v(t).func(e));function d(e,t,n=!0,s=!1,r=o=>o.innerJoin()){if(Array.isArray(e)){const a={};for(const u of e)a[u]=d(u,t,n);return a}const o=t.length;var i;return n?i=function(...a){a=a.map(v);const u=a[a.length-1];let f;if(o===1)f=t(u);else{const l=a.slice(0,-1);if(l.every(h=>h.__pure!=null)){const h=l.map(p=>p.__pure),y=l.filter(p=>p.__pure_loc).map(p=>p.__pure_loc);f=t(...h,u),f=f.withContext(p=>{const _=(p.locations||[]).concat(y);return{...p,locations:_}})}else{const[h,...y]=l;let p=(..._)=>t(..._,u);p=A(p,null,o-1),f=r(y.reduce((_,b)=>_.appLeft(b),h.fmap(p)))}}return s&&(f.tactus=u.tactus),f}:i=function(...a){a=a.map(v);const u=t(...a);return s&&(u.tactus=a[a.length-1].tactus),u},m.prototype[e]=function(...a){if(o===2&&a.length!==1)a=[rt(...a)];else if(o!==a.length+1)throw new Error(`.${e}() expects ${o-1} inputs but got ${a.length}.`);return a=a.map(v),i(...a,this)},o>1&&(m.prototype["_"+e]=function(...a){return t(...a,this)}),A(i,null,o)}function Jt(e,t,n=!0,s=!1,r=o=>o.stepJoin()){return d(e,t,n,s,r)}const yu=d("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),gu=d("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),wu=d("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),bu=d("toBipolar",function(e){return e.fmap(t=>t*2-1)}),vu=d("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),_u=d("range",function(e,t,n){return n.mul(t-e).add(e)}),ku=d("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),qu=d("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),Au=d("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,s)=>n/s,t[0]):t)),Tu=d("compress",function(e,t,n){return e=g(e),t=g(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?P:n._fastGap(g(1).div(t.sub(e)))._late(e)}),{compressSpan:Cu,compressspan:Mu}=d(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Su,fastgap:Nu}=d(["fastGap","fastgap"],function(e,t){const n=function(r){const o=r.begin.sam(),i=r.begin.sub(o).mul(e).min(1),a=r.end.sub(o).mul(e).min(1);if(!(i>=1))return new F(o.add(i),o.add(a))},s=function(r){const o=r.part.begin,i=r.part.end,a=o.sam(),u=o.sub(a).div(e).min(1),f=i.sub(a).div(e).min(1),l=new F(a.add(u),a.add(f)),h=r.whole?new F(l.begin.sub(o.sub(r.whole.begin).div(e)),l.end.add(r.whole.end.sub(i).div(e))):void 0;return new $(h,l,r.value,r.context)};return t.withQuerySpanMaybe(n).withHap(s).splitQueries()}),Ou=d("focus",function(e,t,n){return e=g(e),t=g(t),n._fast(g(1).div(t.sub(e))).late(e.cyclePos())}),{focusSpan:Bu,focusspan:Pu}=d(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),zu=d("ply",function(e,t){const n=t.fmap(s=>ot(s)._fast(e)).squeezeJoin();return et&&(n.tactus=g(e).mulmaybe(t.tactus)),n}),{fast:Eu,density:kh}=d(["fast","density"],function(e,t){return e===0?P:(e=g(e),t.withQueryTime(s=>s.mul(e)).withHapTime(s=>s.div(e)).setTactus(t.tactus))},!0,!0),xu=d("hurry",function(e,t){return t._fast(e).mul(ot({speed:e}))}),{slow:ju,sparsity:$u}=d(["slow","sparsity"],function(e,t){return e===0?P:t._fast(g(1).div(e))}),Fu=d("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),Ru=d("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),Ju=d("lastOf",function(e,t,n){const s=Array(e-1).fill(n);return s.push(t(n)),ae(...s)}),{firstOf:Lu,every:Iu}=d(["firstOf","every"],function(e,t,n){const s=Array(e-1).fill(n);return s.unshift(t(n)),ae(...s)}),Wu=d("apply",function(e,t){return e(t)}),Hu=d("cpm",function(e,t){return t._fast(e/60/1)}),Du=d("early",function(e,t){return e=g(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))},!0,!0),rn=d("late",function(e,t){return e=g(e),t._early(g(0).sub(e))},!0,!0),Vu=d("zoom",function(e,t,n){if(t=g(t),e=g(e),e.gte(t))return X;const s=t.sub(e),r=et?n.tactus.mulmaybe(s):void 0;return n.withQuerySpan(o=>o.withCycle(i=>i.mul(s).add(e))).withHapSpan(o=>o.withCycle(i=>i.sub(e).div(s))).splitQueries().setTactus(r)}),{zoomArc:Qu,zoomarc:Gu}=d(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),Uu=d("linger",function(e,t){return e==0?P:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),Ku=d("segment",function(e,t){return t.struct(ot(!0)._fast(e)).setTactus(e)}),Xu=d("swingBy",(e,t,n)=>n.inside(t,rn(sn(0,e/2)))),Yu=d("swing",(e,t)=>t.swingBy(1/3,e)),{invert:Zu,inv:tl}=d(["invert","inv"],function(e){return e.fmap(t=>!t)},!0,!0),el=d("when",function(e,t,n){return e?t(n):n}),nl=d("off",function(e,t,n){return R(n,t(n.late(e)))}),sl=d("brak",function(e){return e.when(yt(!1,!0),t=>it(t,P)._late(.25))}),on=d("rev",function(e){const t=function(n){const s=n.span,r=s.begin.sam(),o=s.begin.nextSam(),i=function(u){const f=u.withTime(h=>r.add(o.sub(h))),l=f.begin;return f.begin=f.end,f.end=l,f};return e.query(n.setSpan(i(s))).map(u=>u.withSpan(i))};return new m(t).splitQueries()},!1,!0),rl=d("pressBy",function(e,t){return t.fmap(n=>ot(n).compress(e,1)).squeezeJoin()}),ol=d("press",function(e){return e._pressBy(.5)});m.prototype.hush=function(){return P};const il=d("palindrome",function(e){return e.lastOf(2,on)},!0,!0),{juxBy:cl,juxby:al}=d(["juxBy","juxby"],function(e,t,n){e/=2;const s=function(i,a,u){return a in i?i[a]:u},r=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-e})),o=t(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+e})));return R(r,o).setTactus(et?Bt(r.tactus,o.tactus):void 0)}),ul=d("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:ll,echowith:fl,stutWith:hl,stutwith:dl}=d(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,s){return R(...ee(0,e-1).map(r=>n(s.late(g(t).mul(r)),r)))}),pl=d("echo",function(e,t,n,s){return s._echoWith(e,t,(r,o)=>r.gain(Math.pow(n,o)))}),ml=d("stut",function(e,t,n,s){return s._echoWith(e,n,(r,o)=>r.gain(Math.pow(t,o)))}),ue=function(e,t,n=!1){return e=g(e),yt(...ee(0,e.sub(1)).map(s=>n?t.late(g(s).div(e)):t.early(g(s).div(e))))},yl=d("iter",function(e,t){return ue(e,t,!1)},!0,!0),{iterBack:gl,iterback:wl}=d(["iterBack","iterback"],function(e,t){return ue(e,t,!0)},!0,!0),{repeatCycles:bl}=d("repeatCycles",function(e,t){return new m(function(n){const s=n.span.begin.sam(),r=s.div(e).sam(),o=s.sub(r);return n=n.withSpan(i=>i.withTime(a=>a.sub(o))),t.query(n).map(i=>i.withSpan(a=>a.withTime(u=>u.add(o))))}).splitQueries()},!0,!0),le=function(e,t,n,s=!1,r=!1){const o=Array(e-1).fill(!1);o.unshift(!0);const i=ue(e,rt(...o),!s);return r||(n=n.repeatCycles(e)),n.when(i,t)},{chunk:vl,slowchunk:_l,slowChunk:kl}=d(["chunk","slowchunk","slowChunk"],function(e,t,n){return le(e,t,n,!1,!1)}),{chunkBack:ql,chunkback:Al}=d(["chunkBack","chunkback"],function(e,t,n){return le(e,t,n,!0)}),{fastchunk:Tl,fastChunk:Cl}=d(["fastchunk","fastChunk"],function(e,t,n){return le(e,t,n,!1,!0)}),Ml=d("bypass",function(e,t){return e=!!parseInt(e),e?P:t},!0,!0),Sl=d("ribbon",(e,t,n)=>n.early(e).restart(ot(1).slow(t))),Nl=d("hsla",(e,t,n,s,r)=>r.color(`hsla(${e}turn,${t*100}%,${n*100}%,${s})`)),Ol=d("hsl",(e,t,n,s)=>s.color(`hsl(${e}turn,${t*100}%,${n*100}%)`));m.prototype.tag=function(e){return this.withContext(t=>({...t,tags:(t.tags||[]).concat([e])}))};m.prototype.stepJoin=function(){const e=this,t=Y(...Qt(Gt(e.queryArc(0,1)))).tactus,n=function(s){const o=e.early(s.span.begin.sam()).query(s.setSpan(new F(g(0),g(1))));return Y(...Qt(Gt(o))).query(s)};return new m(n,t)};function Qt(e){const t=e.filter((o,i)=>i.hasTactus).reduce((o,i)=>o.add(i),g(0)),n=qt(e.map((o,i)=>i.tactus)).reduce((o,i)=>o.add(i),g(0)),s=t.eq(0)?void 0:n.div(t);function r(o,i){return i.tactus===void 0?[o.mulmaybe(s),i]:[i.tactus,i]}return e.map(o=>r(...o))}function Gt(e){const t=ft(e.map(r=>[r.part.begin,r.part.end])),n=Ge([g(0),g(1),...t]);return Ve(n).map(r=>[r[1].sub(r[0]),R(...cn(new F(...r),e).map(o=>o.value.withHap(i=>i.setContext(i.combineContext(o)))))])}function cn(e,t){return qt(t.map(n=>an(e,n)))}function an(e,t){const n=e.intersection(t.part);if(n!=null)return new $(t.whole,n,t.value,t.context)}const Bl=d("steps",function(e,t){return t.tactus===void 0?t:t.tactus.eq(g(0))?X:t.fast(g(e).div(t.tactus))});function fe(e,...t){const n=t.map(r=>Vt(r));if(n.length==0)return P;e==0&&(e=n[0][1]);const s=[];for(const r of n)r[1]!=0&&(e==r[1]?s.push(r[0]):s.push(r[0]._fast(g(e).div(g(r[1])))));return R(...s)}function un(e,...t){return t.length==0?P:Array.isArray(t[0])?fe(e,...t):he(...t).steps(e)}function he(...e){if(Array.isArray(e[0]))return fe(0,...e);if(e=e.filter(o=>o.hasTactus),e.length==0)return P;const t=e[0].tactus;if(t.eq(g(0)))return X;const[n,...s]=e,r=R(n,...s.map(o=>o._slow(o.tactus.div(t))));return r.tactus=t,r}function Y(...e){if(e.length===0)return X;const t=i=>Array.isArray(i)?i:[i.tactus,i];if(e=e.map(t),e.find(i=>i[0]===void 0)){const i=e.map(u=>u[0]).filter(u=>u!==void 0);if(i.length===0)return it(...e.map(u=>u[1]));if(i.length===e.length)return X;const a=i.reduce((u,f)=>u.add(f),g(0)).div(i.length);for(let u of e)u[0]===void 0&&(u[0]=a)}if(e.length==1){const i=v(e[0][1]);return i.tactus=e[0][0],i}const n=e.map(i=>i[0]).reduce((i,a)=>i.add(a),g(0));let s=g(0);const r=[];for(const[i,a]of e){if(g(i).eq(0))continue;const u=s.add(i);r.push(v(a)._compress(s.div(n),u.div(n))),s=u}const o=R(...r);return o.tactus=n,o}const Pl=Y,ln=Y;function zl(...e){e=e.map(r=>Array.isArray(r)?r.map(v):[v(r)]);const t=Bt(...e.map(r=>g(r.length)));let n=[];for(let r=0;r<t;++r)n.push(...e.map(o=>o.length==0?P:o[r%o.length]));n=n.filter(r=>r.hasTactus&&r.tactus>0);const s=n.reduce((r,o)=>r.add(o.tactus),g(0));return n=Y(...n),n.tactus=s,n}const El=Jt("s_add",function(e,t){if(!t.hasTactus||t.tactus.lte(0)||(e=g(e),e.eq(0)))return X;const n=e<0;n&&(e=e.abs());const s=e.div(t.tactus);return s.lte(0)?X:s.gte(1)?t:n?t.zoom(g(1).sub(s),1):t.zoom(0,s)}),xl=Jt("s_sub",function(e,t){return t.hasTactus?(e=g(e),e.lt(0)?t.s_add(g(0).sub(t.tactus.add(e))):t.s_add(t.tactus.sub(e))):X}),jl=Jt("s_expand",function(e,t){return t.withTactus(n=>n.mul(g(e)))}),$l=Jt("s_contract",function(e,t){return t.withTactus(n=>n.div(g(e)))});m.prototype.s_taperlist=function(e,t){const n=this;if(!n.hasTactus)return[n];if(t=t-1,t===0)return[n];const s=[],r=e>0;e=g(Math.abs(e));const o=n.tactus.sub(e.mul(g(t))).max(g(0));for(let i=0;i<t;++i)s.push(n.zoom(0,o.add(e.mul(g(i))).div(n.tactus)));return s.push(n),r&&s.reverse(),s};const Fl=(e,t,n)=>n.s_taperlist(e,t),Rl=d("s_taper",function(e,t,n){if(!n.hasTactus)return X;const s=n.s_taperlist(e,t),r=Y(...s);return r.tactus=s.reduce((o,i)=>o.add(i.tactus),g(0)),r},!0,!1,e=>e.stepJoin());m.prototype.s_tour=function(...e){return Y(...[].concat(...e.map((t,n)=>[...e.slice(0,e.length-n),this,...e.slice(e.length-n)]),this,...e))};const Jl=function(e,...t){return e.s_tour(...t)},Ll=d("chop",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=function(o){return rt(s.map(i=>Object.assign({},o,i)))};return t.squeezeBind(r).setTactus(et?g(e).mulmaybe(t.tactus):void 0)}),Il=d("striate",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=yt(...s);return t.set(r)._fast(e).setTactus(et?g(e).mulmaybe(t.tactus):void 0)}),fn=function(e,t,n=.5){return t.speed(1/e*n).unit("c").slow(e)},hn=d("slice",function(e,t,n){return e.innerBind(s=>t.outerBind(r=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(s)?s[r]:r/s,a=Array.isArray(s)?s[r+1]:(r+1)/s;return ot({begin:i,end:a,_slices:s,...o})}))).setTactus(t.tactus)},!1),Wl=d("splice",function(e,t,n){const s=hn(e,t,n);return new m(r=>{const o=r.controls._cps||1;return s.query(r).map(a=>a.withValue(u=>({speed:o/u._slices/a.whole.duration*(u.speed||1),unit:"c",...u})))}).setTactus(t.tactus)},!1),{loopAt:Hl,loopat:Dl}=d(["loopAt","loopat"],function(e,t){return new m(n=>fn(e,t,n.controls._cps).query(n))}),Vl=d("fit",e=>e.withHaps((t,n)=>t.map(s=>s.withValue(r=>({...r,speed:(n.controls._cps||1)/s.whole.duration,unit:"c"}))))),{loopAtCps:Ql,loopatcps:Gl}=d(["loopAtCps","loopatcps"],function(e,t,n){return fn(e,n,t)}),Ul=e=>ot(1).withValue(()=>v(e())).innerJoin();let Be=e=>e<.5?1:1-(e-.5)/.5,dn=(e,t,n)=>{t=v(t),e=v(e),n=v(n);let s=t.fmap(o=>({gain:Be(o)})),r=t.fmap(o=>({gain:Be(1-o)}));return R(e.mul(s),n.mul(r))};m.prototype.xfade=function(e,t){return dn(this,e,t)};function Lt(e){let t=Array.isArray(e);e=t?e:[e];const n=e[0],s=i=>{let a;if(typeof i=="object"&&i.value!==void 0&&(a={...i},i=i.value,delete a.value),t&&Array.isArray(i)){const u=a||{};return i.forEach((f,l)=>{l<e.length&&(u[e[l]]=f)}),u}else return a?(a[n]=i,a):{[n]:i}},r=(...i)=>rt(...i).withValue(s),o=function(...i){return i.length?this.set(r(...i)):this.fmap(s)};return m.prototype[n]=o,r}function c(e,...t){const n=Array.isArray(e)?e[0]:e;let s={};return s[n]=Lt(e),t.forEach(r=>{s[r]=s[n],m.prototype[r]=m.prototype[n]}),s}const{s:pn,sound:mn}=c(["s","n","gain"],"sound"),{source:yn,src:gn}=c("source","src"),{n:wn}=c("n"),{note:bn}=c(["note","n"]),{accelerate:vn}=c("accelerate"),{velocity:_n}=c("velocity"),{gain:kn}=c("gain"),{postgain:qn}=c("postgain"),{amp:An}=c("amp"),{attack:Tn,att:Cn}=c("attack","att"),{fmh:Mn}=c(["fmh","fmi"],"fmh"),{fmi:Sn,fm:Nn}=c(["fmi","fmh"],"fm"),{fmenv:On}=c("fmenv"),{fmattack:Bn}=c("fmattack"),{fmdecay:Pn}=c("fmdecay"),{fmsustain:zn}=c("fmsustain"),{fmrelease:En}=c("fmrelease"),{fmvelocity:xn}=c("fmvelocity"),{bank:jn}=c("bank"),{analyze:$n}=c("analyze"),{fft:Fn}=c("fft"),{decay:Rn,dec:Jn}=c("decay","dec"),{sustain:Ln,sus:In}=c("sustain","sus"),{release:Wn,rel:Hn}=c("release","rel"),{hold:Dn}=c("hold"),{bandf:Vn,bpf:Qn,bp:Gn}=c(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:Un,bpq:Kn}=c("bandq","bpq"),{begin:Xn}=c("begin"),{end:Yn}=c("end"),{loop:Zn}=c("loop"),{loopBegin:ts,loopb:es}=c("loopBegin","loopb"),{loopEnd:ns,loope:ss}=c("loopEnd","loope"),{crush:rs}=c("crush"),{coarse:os}=c("coarse"),{drive:is}=c("drive"),{channels:cs,ch:as}=c("channels","ch"),{phaserrate:us,phasr:ls}=c("phaserrate","phasr"),{phaser:fs,ph:hs}=c(["phaser","phaserdepth","phasercenter","phasersweep"],"ph"),{phasersweep:ds,phs:ps}=c("phasersweep","phs"),{phasercenter:ms,phc:ys}=c("phasercenter","phc"),{phaserdepth:gs,phd:ws,phasdp:bs}=c("phaserdepth","phd","phasdp"),{channel:vs}=c("channel"),{cut:_s}=c("cut"),{cutoff:ks,ctf:qs,lpf:As,lp:Ts}=c(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Cs,lpe:Ms}=c("lpenv","lpe"),{hpenv:Ss,hpe:Ns}=c("hpenv","hpe"),{bpenv:Os,bpe:Bs}=c("bpenv","bpe"),{lpattack:Ps,lpa:zs}=c("lpattack","lpa"),{hpattack:Es,hpa:xs}=c("hpattack","hpa"),{bpattack:js,bpa:$s}=c("bpattack","bpa"),{lpdecay:Fs,lpd:Rs}=c("lpdecay","lpd"),{hpdecay:Js,hpd:Ls}=c("hpdecay","hpd"),{bpdecay:Is,bpd:Ws}=c("bpdecay","bpd"),{lpsustain:Hs,lps:Ds}=c("lpsustain","lps"),{hpsustain:Vs,hps:Qs}=c("hpsustain","hps"),{bpsustain:Gs,bps:Us}=c("bpsustain","bps"),{lprelease:Ks,lpr:Xs}=c("lprelease","lpr"),{hprelease:Ys,hpr:Zs}=c("hprelease","hpr"),{bprelease:tr,bpr:er}=c("bprelease","bpr"),{ftype:nr}=c("ftype"),{fanchor:sr}=c("fanchor"),{vib:rr,vibrato:or,v:ir}=c(["vib","vibmod"],"vibrato","v"),{noise:cr}=c("noise"),{vibmod:ar,vmod:ur}=c(["vibmod","vib"],"vmod"),{hcutoff:lr,hpf:fr,hp:hr}=c(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:dr,hpq:pr}=c("hresonance","hpq"),{resonance:mr,lpq:yr}=c("resonance","lpq"),{djf:gr}=c("djf"),{delay:wr}=c(["delay","delaytime","delayfeedback"]),{delayfeedback:br,delayfb:vr,dfb:_r}=c("delayfeedback","delayfb","dfb"),{delaytime:kr,delayt:qr,dt:Ar}=c("delaytime","delayt","dt"),{lock:Tr}=c("lock"),{detune:Cr,det:Mr}=c("detune","det"),{unison:Sr}=c("unison"),{spread:Nr}=c("spread"),{dry:Or}=c("dry"),{fadeTime:Br,fadeOutTime:Pr}=c("fadeTime","fadeOutTime"),{fadeInTime:zr}=c("fadeInTime"),{freq:Er}=c("freq"),{pattack:xr,patt:jr}=c("pattack","patt"),{pdecay:$r,pdec:Fr}=c("pdecay","pdec"),{psustain:Rr,psus:Jr}=c("psustain","psus"),{prelease:Lr,prel:Ir}=c("prelease","prel"),{penv:Wr}=c("penv"),{pcurve:Hr}=c("pcurve"),{panchor:Dr}=c("panchor"),{gate:Vr,gat:Qr}=c("gate","gat"),{leslie:Gr}=c("leslie"),{lrate:Ur}=c("lrate"),{lsize:Kr}=c("lsize"),{activeLabel:Xr}=c("activeLabel"),{label:Yr}=c(["label","activeLabel"]),{degree:Zr}=c("degree"),{mtranspose:to}=c("mtranspose"),{ctranspose:eo}=c("ctranspose"),{harmonic:no}=c("harmonic"),{stepsPerOctave:so}=c("stepsPerOctave"),{octaveR:ro}=c("octaveR"),{nudge:oo}=c("nudge"),{octave:io}=c("octave"),{orbit:co}=c("orbit"),{overgain:ao}=c("overgain"),{overshape:uo}=c("overshape"),{pan:lo}=c("pan"),{panspan:fo}=c("panspan"),{pansplay:ho}=c("pansplay"),{panwidth:po}=c("panwidth"),{panorient:mo}=c("panorient"),{rate:yo}=c("rate"),{slide:go}=c("slide"),{semitone:wo}=c("semitone"),{voice:bo}=c("voice"),{chord:vo}=c("chord"),{dictionary:_o,dict:ko}=c("dictionary","dict"),{anchor:qo}=c("anchor"),{offset:Ao}=c("offset"),{octaves:To}=c("octaves"),{mode:Co}=c(["mode","anchor"]),{room:Mo}=c(["room","size"]),{roomlp:So,rlp:No}=c("roomlp","rlp"),{roomdim:Oo,rdim:Bo}=c("roomdim","rdim"),{roomfade:Po,rfade:zo}=c("roomfade","rfade"),{ir:Eo,iresponse:xo}=c(["ir","i"],"iresponse"),{roomsize:jo,size:$o,sz:Fo,rsize:Ro}=c("roomsize","size","sz","rsize"),{shape:Jo}=c(["shape","shapevol"]),{distort:Lo,dist:Io}=c(["distort","distortvol"],"dist"),{compressor:Wo}=c(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:Ho}=c("compressorKnee"),{compressorRatio:Do}=c("compressorRatio"),{compressorAttack:Vo}=c("compressorAttack"),{compressorRelease:Qo}=c("compressorRelease"),{speed:Go}=c("speed"),{unit:Uo}=c("unit"),{squiz:Ko}=c("squiz"),{vowel:Xo}=c("vowel"),{waveloss:Yo}=c("waveloss"),{density:Kl}=c("density"),{expression:Zo}=c("expression"),{sustainpedal:ti}=c("sustainpedal"),{tremolodepth:ei,tremdp:ni}=c("tremolodepth","tremdp"),{tremolorate:si,tremr:ri}=c("tremolorate","tremr"),{fshift:oi}=c("fshift"),{fshiftnote:ii}=c("fshiftnote"),{fshiftphase:ci}=c("fshiftphase"),{triode:ai}=c("triode"),{krush:ui}=c("krush"),{kcutoff:li}=c("kcutoff"),{octer:fi}=c("octer"),{octersub:hi}=c("octersub"),{octersubsub:di}=c("octersubsub"),{ring:pi}=c("ring"),{ringf:mi}=c("ringf"),{ringdf:yi}=c("ringdf"),{freeze:gi}=c("freeze"),{xsdelay:wi}=c("xsdelay"),{tsdelay:bi}=c("tsdelay"),{real:vi}=c("real"),{imag:_i}=c("imag"),{enhance:ki}=c("enhance"),{partials:qi}=c("partials"),{comb:Ai}=c("comb"),{smear:Ti}=c("smear"),{scram:Ci}=c("scram"),{binshift:Mi}=c("binshift"),{hbrick:Si}=c("hbrick"),{lbrick:Ni}=c("lbrick"),{midichan:Oi}=c("midichan"),{control:Bi}=c("control"),{ccn:Pi}=c("ccn"),{ccv:zi}=c("ccv"),{polyTouch:Ei}=c("polyTouch"),{midibend:xi}=c("midibend"),{miditouch:ji}=c("miditouch"),{ctlNum:$i}=c("ctlNum"),{frameRate:Fi}=c("frameRate"),{frames:Ri}=c("frames"),{hours:Ji}=c("hours"),{midicmd:Li}=c("midicmd"),{minutes:Ii}=c("minutes"),{progNum:Wi}=c("progNum"),{seconds:Hi}=c("seconds"),{songPtr:Di}=c("songPtr"),{uid:Vi}=c("uid"),{val:Qi}=c("val"),{cps:Gi}=c("cps"),{clip:Ui,legato:Ki}=c("clip","legato"),{duration:Xi,dur:Yi}=c("duration","dur"),{zrand:Zi}=c("zrand"),{curve:tc}=c("curve"),{deltaSlide:ec}=c("deltaSlide"),{pitchJump:nc}=c("pitchJump"),{pitchJumpTime:sc}=c("pitchJumpTime"),{lfo:rc,repeatTime:oc}=c("lfo","repeatTime"),{znoise:ic}=c("znoise"),{zmod:cc}=c("zmod"),{zcrush:ac}=c("zcrush"),{zdelay:uc}=c("zdelay"),{tremolo:lc}=c("tremolo"),{zzfx:fc}=c("zzfx"),{color:hc,colour:dc}=c(["color","colour"]);let de=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:Lt(n)}),{});const pc=d("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s,r,o]=e;return t.set({attack:n,decay:s,sustain:r,release:o})}),mc=d("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.attack(n).decay(s)}),yc=d("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=0]=e;return t.set({decay:n,sustain:s})}),gc=d("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.set({attack:n,release:s})}),Xl=Object.freeze(Object.defineProperty({__proto__:null,accelerate:vn,activeLabel:Xr,ad:mc,adsr:pc,amp:An,analyze:$n,anchor:qo,ar:gc,att:Cn,attack:Tn,bandf:Vn,bandq:Un,bank:jn,begin:Xn,binshift:Mi,bp:Gn,bpa:$s,bpattack:js,bpd:Ws,bpdecay:Is,bpe:Bs,bpenv:Os,bpf:Qn,bpq:Kn,bpr:er,bprelease:tr,bps:Us,bpsustain:Gs,ccn:Pi,ccv:zi,ch:as,channel:vs,channels:cs,chord:vo,clip:Ui,coarse:os,color:hc,colour:dc,comb:Ai,compressor:Wo,compressorAttack:Vo,compressorKnee:Ho,compressorRatio:Do,compressorRelease:Qo,control:Bi,cps:Gi,createParam:Lt,createParams:de,crush:rs,ctf:qs,ctlNum:$i,ctranspose:eo,curve:tc,cut:_s,cutoff:ks,dec:Jn,decay:Rn,degree:Zr,delay:wr,delayfb:vr,delayfeedback:br,delayt:qr,delaytime:kr,deltaSlide:ec,density:Kl,det:Mr,detune:Cr,dfb:_r,dict:ko,dictionary:_o,dist:Io,distort:Lo,djf:gr,drive:is,dry:Or,ds:yc,dt:Ar,dur:Yi,duration:Xi,end:Yn,enhance:ki,expression:Zo,fadeInTime:zr,fadeOutTime:Pr,fadeTime:Br,fanchor:sr,fft:Fn,fm:Nn,fmattack:Bn,fmdecay:Pn,fmenv:On,fmh:Mn,fmi:Sn,fmrelease:En,fmsustain:zn,fmvelocity:xn,frameRate:Fi,frames:Ri,freeze:gi,freq:Er,fshift:oi,fshiftnote:ii,fshiftphase:ci,ftype:nr,gain:kn,gat:Qr,gate:Vr,harmonic:no,hbrick:Si,hcutoff:lr,hold:Dn,hours:Ji,hp:hr,hpa:xs,hpattack:Es,hpd:Ls,hpdecay:Js,hpe:Ns,hpenv:Ss,hpf:fr,hpq:pr,hpr:Zs,hprelease:Ys,hps:Qs,hpsustain:Vs,hresonance:dr,imag:_i,ir:Eo,iresponse:xo,kcutoff:li,krush:ui,label:Yr,lbrick:Ni,legato:Ki,leslie:Gr,lfo:rc,lock:Tr,loop:Zn,loopBegin:ts,loopEnd:ns,loopb:es,loope:ss,lp:Ts,lpa:zs,lpattack:Ps,lpd:Rs,lpdecay:Fs,lpe:Ms,lpenv:Cs,lpf:As,lpq:yr,lpr:Xs,lprelease:Ks,lps:Ds,lpsustain:Hs,lrate:Ur,lsize:Kr,midibend:xi,midichan:Oi,midicmd:Li,miditouch:ji,minutes:Ii,mode:Co,mtranspose:to,n:wn,noise:cr,note:bn,nudge:oo,octave:io,octaveR:ro,octaves:To,octer:fi,octersub:hi,octersubsub:di,offset:Ao,orbit:co,overgain:ao,overshape:uo,pan:lo,panchor:Dr,panorient:mo,panspan:fo,pansplay:ho,panwidth:po,partials:qi,patt:jr,pattack:xr,pcurve:Hr,pdec:Fr,pdecay:$r,penv:Wr,ph:hs,phasdp:bs,phaser:fs,phasercenter:ms,phaserdepth:gs,phaserrate:us,phasersweep:ds,phasr:ls,phc:ys,phd:ws,phs:ps,pitchJump:nc,pitchJumpTime:sc,polyTouch:Ei,postgain:qn,prel:Ir,prelease:Lr,progNum:Wi,psus:Jr,psustain:Rr,rate:yo,rdim:Bo,real:vi,registerControl:c,rel:Hn,release:Wn,repeatTime:oc,resonance:mr,rfade:zo,ring:pi,ringdf:yi,ringf:mi,rlp:No,room:Mo,roomdim:Oo,roomfade:Po,roomlp:So,roomsize:jo,rsize:Ro,s:pn,scram:Ci,seconds:Hi,semitone:wo,shape:Jo,size:$o,slide:go,smear:Ti,songPtr:Di,sound:mn,source:yn,speed:Go,spread:Nr,squiz:Ko,src:gn,stepsPerOctave:so,sus:In,sustain:Ln,sustainpedal:ti,sz:Fo,tremdp:ni,tremolo:lc,tremolodepth:ei,tremolorate:si,tremr:ri,triode:ai,tsdelay:bi,uid:Vi,unison:Sr,unit:Uo,v:ir,val:Qi,velocity:_n,vib:rr,vibmod:ar,vibrato:or,vmod:ur,voice:bo,vowel:Xo,waveloss:Yo,xsdelay:wi,zcrush:ac,zdelay:uc,zmod:cc,znoise:ic,zrand:Zi,zzfx:fc},Symbol.toStringTag,{value:"Module"})),Yl=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=re(s,r);return[[s,n-s],[oe((u,f)=>u.concat(f),i,o),a]]},Zl=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=re(n,o);return[[n,s-n],[oe((f,l)=>f.concat(l),r,i),a]]},wc=function(e,t){const[n,s]=e;return Math.min(n,s)<=1?[e,t]:wc(...n>s?Yl(e,t):Zl(e,t))},bc=function(e,t){const n=e<0;e=Math.abs(e);const s=t-e,r=Array(e).fill([1]),o=Array(s).fill([0]),i=wc([e,s],[r,o]),a=ft(i[1][0]).concat(ft(i[1][1]));return n?a.map(u=>u===0?1:0):a},pe=function(e,t,n){const s=bc(e,t);return n?We(s,-n):s},tf=d("euclid",function(e,t,n){return n.struct(pe(e,t,0))}),{euclidrot:ef,euclidRot:nf}=d(["euclidrot","euclidRot"],function(e,t,n,s){return s.struct(pe(e,t,n))}),vc=function(e,t,n,s){if(e<1)return P;const o=pe(e,t,n).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(ln(...o))},sf=d(["euclidLegato"],function(e,t,n){return vc(e,t,0,n)}),rf=d(["euclidLegatoRot"],function(e,t,n,s){return vc(e,t,n,s)});function _c(e,t,n=.05,s=.1,r=.1,o=globalThis.setInterval,i=globalThis.clearInterval,a=!0){let u=0,f=0,l=10**4,h=.01;const y=N=>n=N(n);r=r||s/2;const p=()=>{const N=e(),B=N+s+r;for(f===0&&(f=N+h);f<B;)f=a?Math.round(f*l)/l:f,t(f,n,u,N),f+=n,u++};let _;const b=()=>{q(),p(),_=o(p,s*1e3)},q=()=>{_!==void 0&&i(_),_=void 0};return{setDuration:y,start:b,stop:()=>{u=0,f=0,q()},pause:()=>q(),duration:n,interval:s,getPhase:()=>f,minLatency:h}}function of(e){return new m(t=>[new $(void 0,t.span,e)])}const nt=e=>{const t=n=>[new $(void 0,n.span,e(n.span.midpoint()))];return new m(t)},me=nt(e=>1-e%1),kc=me.toBipolar(),It=nt(e=>e%1),qc=It.toBipolar(),ye=nt(e=>Math.sin(Math.PI*2*e)),Ac=ye.fromBipolar(),cf=Ac._early(g(1).div(4)),af=ye._early(g(1).div(4)),Tc=nt(e=>Math.floor(e*2%2)),uf=Tc.toBipolar(),lf=it(me,It),ff=it(kc,qc),Cc=nt(bt);let ge=0,we=0;typeof window<"u"&&document.addEventListener("mousemove",e=>{ge=e.clientY/document.body.clientHeight,we=e.clientX/document.body.clientWidth});const hf=nt(()=>ge),df=nt(()=>ge),pf=nt(()=>we),mf=nt(()=>we),yf=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},gf=e=>e-Math.trunc(e),wf=e=>yf(Math.trunc(gf(e/300)*536870912)),bf=e=>e%536870912/536870912,Ut=e=>Math.abs(bf(wf(e))),vf=e=>It.range(0,e).floor().segment(e),Z=nt(Ut),_f=Z.toBipolar(),be=e=>Z.fmap(t=>t<e),kf=e=>v(e).fmap(be).innerJoin(),qf=be(.5),Mc=e=>Z.fmap(t=>Math.trunc(t*e)),Af=e=>v(e).fmap(Mc).innerJoin(),ct=function(e,t,n=!0){const s=Array.isArray(e),r=Object.keys(e).length;return e=Xe(e,v),r===0?P:t.fmap(o=>{let i=o;return s&&(i=n?Math.round(i)%r:Qe(Math.round(i),0,e.length-1)),e[i]})},Sc=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),Tf(e,t)},Tf=d("pick",function(e,t){return ct(e,t,!1).innerJoin()}),Nc=d("pickmod",function(e,t){return ct(e,t,!0).innerJoin()}),Cf=d("pickF",function(e,t,n){return n.apply(Sc(e,t))}),Mf=d("pickmodF",function(e,t,n){return n.apply(Nc(e,t))}),Sf=d("pickOut",function(e,t){return ct(e,t,!1).outerJoin()}),Nf=d("pickmodOut",function(e,t){return ct(e,t,!0).outerJoin()}),Of=d("pickRestart",function(e,t){return ct(e,t,!1).restartJoin()}),Bf=d("pickmodRestart",function(e,t){return ct(e,t,!0).restartJoin()}),Pf=d("pickReset",function(e,t){return ct(e,t,!1).resetJoin()}),zf=d("pickmodReset",function(e,t){return ct(e,t,!0).resetJoin()}),{inhabit:Ef,pickSqueeze:xf}=d(["inhabit","pickSqueeze"],function(e,t){return ct(e,t,!1).squeezeJoin()}),{inhabitmod:jf,pickmodSqueeze:$f}=d(["inhabitmod","pickmodSqueeze"],function(e,t){return ct(e,t,!0).squeezeJoin()}),Ff=(e,t)=>(t=t.map(v),t.length==0?P:e.fmap(n=>{const s=Ot(Math.round(n),t.length);return t[s]}).squeezeJoin()),ve=(e,t)=>(t=t.map(v),t.length==0?P:e.range(0,t.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[s]})),Wt=(e,t)=>ve(e,t).outerJoin(),Oc=(e,t)=>ve(e,t).innerJoin(),Rf=(...e)=>Wt(Z,e);m.prototype.choose=function(...e){return Wt(this,e)};m.prototype.choose2=function(...e){return Wt(this.fromBipolar(),e)};const Bc=(...e)=>Oc(Z.segment(1),e),Jf=Bc,Pc=function(e,...t){const n=t.map(a=>v(a[0])),s=[];let r=0;for(const a of t)r+=a[1],s.push(r);const o=r,i=function(a){const u=a*o;return n[s.findIndex(f=>f>u,s)]};return e.fmap(i)},Lf=(...e)=>Pc(...e).outerJoin(),If=(...e)=>Lf(Z,...e),zc=(...e)=>Pc(Z.segment(1),...e).innerJoin(),Wf=zc,Ec=e=>{const t=e.fmap(Math.floor),n=e.fmap(o=>Math.floor(o)+1),s=o=>6*o**5-15*o**4+10*o**3,r=o=>i=>a=>i+s(o)*(a-i);return e.sub(t).fmap(r).appBoth(t.fmap(Ut)).appBoth(n.fmap(Ut))},Hf=Ec(Cc.fmap(e=>Number(e))),Df=d("degradeByWith",(e,t,n)=>n.fmap(s=>r=>s).appLeft(e.filterValues(s=>s>t))),Vf=d("degradeBy",function(e,t){return t._degradeByWith(Z,e)}),Qf=d("degrade",e=>e._degradeBy(.5)),Gf=d("undegradeBy",function(e,t){return t._degradeByWith(Z.fmap(n=>1-n),e)}),Uf=d("undegrade",e=>e._undegradeBy(.5)),Kf=d("sometimesBy",function(e,t,n){return v(e).fmap(s=>R(n._degradeBy(s),t(n._undegradeBy(1-s)))).innerJoin()}),Xf=d("sometimes",function(e,t){return t._sometimesBy(.5,e)}),Yf=d("someCyclesBy",function(e,t,n){return v(e).fmap(s=>R(n._degradeByWith(Z._segment(1),s),t(n._degradeByWith(Z.fmap(r=>1-r)._segment(1),1-s)))).innerJoin()}),Zf=d("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),th=d("often",function(e,t){return t.sometimesBy(.75,e)}),eh=d("rarely",function(e,t){return t.sometimesBy(.25,e)}),nh=d("almostNever",function(e,t){return t.sometimesBy(.1,e)}),sh=d("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),rh=d("never",function(e,t){return t}),oh=d("always",function(e,t){return e(t)});let Ft;try{Ft=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let Pe=Ft?.getVoices();function ih(e,t,n){Ft.cancel();const s=new SpeechSynthesisUtterance(e);s.lang=t,Pe=Ft.getVoices();const r=Pe.filter(o=>o.lang.includes(t));typeof n=="number"?s.voice=r[n%r.length]:typeof n=="string"&&(s.voice=r.find(o=>o.name===o)),speechSynthesis.speak(s)}const ch=d("speak",function(e,t,n){return n.onTrigger((s,r)=>{ih(r.value,e,t)})}),xc=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="fulfilled").map(s=>s.value);return t.forEach((s,r)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${r} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([r,o])=>{globalThis[r]=o})}),n};function ah(e,t={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=t;n&&(e=`{${e}}`),s&&(e=`(async ()=>${e})()`);const r=`"use strict";return (${e})`;return Function(r)()}const jc=async(e,t)=>{let n={};if(t){const o=t(e);e=o.output,n=o}return{mode:"javascript",pattern:await ah(e,{wrapExpression:!!t}),meta:n}};class uh{constructor({onTrigger:t,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.lastTick=0,this.getTime=s,this.time_at_last_tick_message=0,this.num_cycles_at_cps_change=0,this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker_time_dif,this.worker=new SharedWorker(new URL("/assets/clockworker-OodvW4tn.js",import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");let r=0;const o=20,i=10**3,a=(l,h,y)=>{const p=s()-(l+h)+y;if(this.worker_time_dif==null)this.worker_time_dif=p;else{const b=Math.round((this.worker_time_dif*r+p*1)/(r+1)*i)/i;b!=this.worker_time_dif&&(r=4),this.worker_time_dif=b}r=Math.min(r+1,o)},u=l=>{const{num_cycles_at_cps_change:h,cps:y,num_seconds_at_cps_change:p,num_seconds_since_cps_change:_,begin:b,end:q,tickdeadline:k,cycle:O}=l;this.cps=y,this.cycle=O,a(p,_,k),f(b,q,h,p),this.time_at_last_tick_message=this.getTime()},f=(l,h,y,p)=>{if(this.started===!1)return;this.pattern.queryArc(l,h,{_cps:this.cps}).forEach(b=>{if(b.hasOnset()){const q=(b.whole.begin-y)/this.cps+p+this.latency+this.worker_time_dif,k=b.duration/this.cps;t?.(b,0,k,this.cps,q)}})};this.channel.onmessage=l=>{if(!this.started)return;const{payload:h,type:y}=l.data;switch(y){case"tick":u(h)}}}sendMessage(t,n){this.worker.port.postMessage({type:t,payload:n,id:this.id})}now(){const t=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+t}setCps(t=1){this.sendMessage("cpschange",{cps:t})}setCycle(t){this.sendMessage("setcycle",{cycle:t})}setStarted(t){this.sendMessage("toggle",{started:t}),this.started=t,this.onToggle?.(t)}start(){W("[cyclist] start"),this.setStarted(!0)}stop(){this.worker_time_dif=null,W("[cyclist] stop"),this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}class $c{constructor({interval:t,onTrigger:n,onToggle:s,onError:r,getTime:o,latency:i=.1,setInterval:a,clearInterval:u}){this.started=!1,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=_c(o,(f,l,h,y)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=f),this.num_ticks_since_cps_change++;const _=this.num_ticks_since_cps_change*l*this.cps;try{const b=this.lastEnd;this.lastBegin=b;const q=this.num_cycles_at_cps_change+_;if(this.lastEnd=q,this.lastTick=f,f<y){console.log("skip query: too late");return}this.pattern.queryArc(b,q,{_cps:this.cps}).forEach(O=>{if(O.hasOnset()){const E=(O.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,N=O.duration/this.cps,B=E-f;n?.(O,B,N,this.cps,E)}})}catch(b){W(`[cyclist] error: ${b.message}`),r?.(b)}},t,.1,.1,a,u)}now(){if(!this.started)return 0;const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}start(){if(this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");W("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){W("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){W("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}setCps(t=.5){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let Kt;function Xt(){if(!Kt)throw new Error("no time set! use setTime to define a time source");return Kt()}function Fc(e){Kt=e}function lh({defaultOutput:e,onEvalError:t,beforeEval:n,afterEval:s,getTime:r,transpiler:o,onToggle:i,editPattern:a,onUpdateState:u,sync:f=!1,setInterval:l,clearInterval:h}){const y={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},p=C=>{Object.assign(y,C),y.isDirty=y.code!==y.activeCode,y.error=y.evalError||y.schedulerError,u?.(y)},_={onTrigger:Rc({defaultOutput:e,getTime:r}),getTime:r,onToggle:C=>{p({started:C}),i?.(C)},setInterval:l,clearInterval:h},b=f&&typeof SharedWorker<"u"?new uh(_):new $c(_);let q={},k=0,O;const E=function(){return q={},k=0,O=void 0,P},N=(C,M=!0)=>{C=a?.(C)||C,b.setPattern(C,M)};Fc(()=>b.now());const B=()=>b.stop(),J=()=>b.start(),tt=()=>b.pause(),H=()=>b.toggle(),I=C=>b.setCps(C),T=C=>b.setCps(C/60),at=function(C){return O=C,P},L=()=>{m.prototype.p=function(M){return M.startsWith("_")||M.endsWith("_")?P:(M==="$"&&(M=`$${k}`,k++),q[M]=this,this)},m.prototype.q=function(M){return P};try{for(let M=1;M<10;++M)Object.defineProperty(m.prototype,`d${M}`,{get(){return this.p(M)},configurable:!0}),Object.defineProperty(m.prototype,`p${M}`,{get(){return this.p(M)},configurable:!0}),m.prototype[`q${M}`]=P}catch(M){console.warn("injectPatternMethods: error:",M)}const C=d("cpm",function(M,V){return V._fast(M/60/b.cps)});return xc({all:at,hush:E,cpm:C,setCps:I,setcps:I,setCpm:T,setcpm:T})};return{scheduler:b,evaluate:async(C,M=!0,V=!0)=>{if(!C)throw new Error("no code to evaluate");try{p({code:C,pending:!0}),await L(),await n?.({code:C}),V&&E();let{pattern:j,meta:dt}=await jc(C,o);if(Object.keys(q).length&&(j=R(...Object.values(q))),O&&(j=O(j)),!ie(j)){const Pt=`got "${typeof evaluated}" instead of pattern`;throw new Error(Pt+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return W("[eval] code updated"),N(j,M),p({miniLocations:dt?.miniLocations||[],widgets:dt?.widgets||[],activeCode:C,pattern:j,evalError:void 0,schedulerError:void 0,pending:!1}),s?.({code:C,pattern:j,meta:dt}),j}catch(j){W(`[eval] error: ${j.message}`,"error"),console.error(j),p({evalError:j,pending:!1}),t?.(j)}},start:J,stop:B,pause:tt,setCps:I,setPattern:N,setCode:C=>p({code:C}),toggle:H,state:y}}const Rc=({getTime:e,defaultOutput:t})=>async(n,s,r,o,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,s,r,o,i),n.context.onTrigger&&await n.context.onTrigger(e()+s,n,e(),o,i)}catch(a){W(`[cyclist] error: ${a.message}`,"error")}},fh=function(e,t={}){const n=document.getElementById("code"),s="background-image:url("+e+");background-size:contain;";n.style=s;const{className:r}=n,o=(u,f)=>{({style:()=>n.style=s+";"+f,className:()=>n.className=f+" "+r})[u]()},i=Object.entries(t).filter(([u,f])=>typeof f=="function");Object.entries(t).filter(([u,f])=>typeof f=="string").forEach(([u,f])=>o(u,f)),i.length},hh=()=>{const e=document.getElementById("code");e&&(e.style="")};W("🌀 @strudel/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const qh=Object.freeze(Object.defineProperty({__proto__:null,Cyclist:$c,Fraction:g,Hap:$,Pattern:m,State:_t,TimeSpan:F,__chooseWith:ve,_brandBy:be,_fitslice:cn,_irand:Mc,_match:an,_mod:Ot,_polymeterListSteps:fe,_retime:Qt,_slices:Gt,accelerate:vn,activeLabel:Xr,ad:mc,add:Ga,adsr:pc,almostAlways:sh,almostNever:nh,always:oh,amp:An,analyze:$n,anchor:qo,and:du,apply:Wu,ar:gc,arrange:La,att:Cn,attack:Tn,backgroundImage:fh,band:tu,bandf:Vn,bandq:Un,bank:jn,base64ToUnicode:Ke,begin:Xn,binshift:Mi,bjork:bc,blshift:su,bor:eu,bp:Gn,bpa:$s,bpattack:js,bpd:Ws,bpdecay:Is,bpe:Bs,bpenv:Os,bpf:Qn,bpq:Kn,bpr:er,bprelease:tr,bps:Us,bpsustain:Gs,brak:sl,brand:qf,brandBy:kf,brshift:ru,bxor:nu,bypass:Ml,calculateTactus:Pa,cat:nn,ccn:Pi,ccv:zi,ceil:wu,ch:as,channel:vs,channels:cs,choose:Rf,chooseCycles:Bc,chooseInWith:Oc,chooseWith:Wt,chop:Ll,chord:vo,chunk:vl,chunkBack:ql,chunkback:Al,clamp:Qe,cleanupUi:hh,clip:Ui,coarse:os,code2hash:Sa,color:hc,colour:dc,comb:Ai,compose:ya,compress:Tu,compressSpan:Cu,compressor:Wo,compressorAttack:Vo,compressorKnee:Ho,compressorRatio:Do,compressorRelease:Qo,compressspan:Mu,constant:ga,control:Bi,controls:Xl,cosine:cf,cosine2:af,cpm:Hu,cps:Gi,createClock:_c,createParam:Lt,createParams:de,crush:rs,ctf:qs,ctlNum:$i,ctranspose:eo,curry:A,curve:tc,cut:_s,cutoff:ks,dec:Jn,decay:Rn,degrade:Qf,degradeBy:Vf,degradeByWith:Df,degree:Zr,delay:wr,delayfb:vr,delayfeedback:br,delayt:qr,delaytime:kr,deltaSlide:ec,det:Mr,detune:Cr,dfb:_r,dict:ko,dictionary:_o,dist:Io,distort:Lo,div:Xa,djf:gr,drawLine:Ye,drive:is,dry:Or,ds:yc,dt:Ar,dur:Yi,duration:Xi,early:Du,echo:pl,echoWith:ll,echowith:fl,end:Yn,enhance:ki,eq:uu,eqt:lu,euclid:tf,euclidLegato:sf,euclidLegatoRot:rf,euclidRot:nf,euclidrot:ef,evalScope:xc,evaluate:jc,every:Iu,expression:Zo,fadeInTime:zr,fadeOutTime:Pr,fadeTime:Br,fanchor:sr,fast:Eu,fastChunk:Cl,fastGap:Su,fastcat:it,fastchunk:Tl,fastgap:Nu,fft:Fn,firstOf:Lu,fit:Vl,flatten:ft,floor:gu,fm:Nn,fmattack:Bn,fmdecay:Pn,fmenv:On,fmh:Mn,fmi:Sn,fmrelease:En,fmsustain:zn,fmvelocity:xn,focus:Ou,focusSpan:Bu,focusspan:Pu,fractionalArgs:wa,frameRate:Fi,frames:Ri,freeze:gi,freq:Er,freqToMidi:te,fromBipolar:vu,fshift:oi,fshiftnote:ii,fshiftphase:ci,ftype:nr,func:mu,gain:kn,gap:At,gat:Qr,gate:Vr,getEventOffsetMs:fa,getFreq:Je,getFrequency:Ie,getPlayableNoteValue:ma,getSoundIndex:pa,getTime:Xt,getTrigger:Rc,gt:iu,gte:au,harmonic:no,hash2code:Na,hbrick:Si,hcutoff:lr,hold:Dn,hours:Ji,hp:hr,hpa:xs,hpattack:Es,hpd:Ls,hpdecay:Js,hpe:Ns,hpenv:Ss,hpf:fr,hpq:pr,hpr:Zs,hprelease:Ys,hps:Qs,hpsustain:Vs,hresonance:dr,hsl:Ol,hsla:Nl,hurry:xu,id:bt,imag:_i,inhabit:Ef,inhabitmod:jf,inside:Fu,inv:tl,invert:Zu,ir:Eo,irand:Af,iresponse:xo,isNote:Rt,isNoteWithOctave:ca,isPattern:ie,isaw:me,isaw2:kc,iter:yl,iterBack:gl,iterback:wl,jux:ul,juxBy:cl,juxby:al,kcutoff:li,keep:Va,keepif:Qa,krush:ui,label:Yr,lastOf:Ju,late:rn,lbrick:Ni,legato:Ki,leslie:Gr,lfo:rc,linger:Uu,listRange:ee,lock:Tr,logKey:Zt,logger:W,loop:Zn,loopAt:Hl,loopAtCps:Ql,loopBegin:ts,loopEnd:ns,loopat:Dl,loopatcps:Gl,loopb:es,loope:ss,lp:Ts,lpa:zs,lpattack:Ps,lpd:Rs,lpdecay:Fs,lpe:Ms,lpenv:Cs,lpf:As,lpq:yr,lpr:Xs,lprelease:Ks,lps:Ds,lpsustain:Hs,lrate:Ur,lsize:Kr,lt:ou,lte:cu,mapArgs:se,mask:Ia,midi2note:da,midiToFreq:mt,midibend:xi,midichan:Oi,midicmd:Li,miditouch:ji,minutes:Ii,mod:Ya,mode:Co,mouseX:mf,mouseY:df,mousex:pf,mousey:hf,mtranspose:to,mul:Ka,n:wn,nanFallback:Le,ne:fu,net:hu,never:rh,noise:cr,note:bn,noteToMidi:kt,nothing:X,nudge:oo,numeralArgs:K,objectMap:Xe,octave:io,octaveR:ro,octaves:To,octer:fi,octersub:hi,octersubsub:di,off:nl,offset:Ao,often:th,or:pu,orbit:co,outside:Ru,overgain:ao,overshape:uo,pairs:Ve,palindrome:il,pan:lo,panchor:Dr,panorient:mo,panspan:fo,pansplay:ho,panwidth:po,parseFractional:De,parseNumeral:ne,partials:qi,patt:jr,pattack:xr,pcurve:Hr,pdec:Fr,pdecay:$r,penv:Wr,perlin:Hf,perlinWith:Ec,ph:hs,phasdp:bs,phaser:fs,phasercenter:ms,phaserdepth:gs,phaserrate:us,phasersweep:ds,phasr:ls,phc:ys,phd:ws,phs:ps,pick:Sc,pickF:Cf,pickOut:Sf,pickReset:Pf,pickRestart:Of,pickSqueeze:xf,pickmod:Nc,pickmodF:Mf,pickmodOut:Nf,pickmodReset:zf,pickmodRestart:Bf,pickmodSqueeze:$f,pipe:He,pitchJump:nc,pitchJumpTime:sc,ply:zu,pm:Ra,polyTouch:Ei,polyrhythm:$a,postgain:qn,pow:Za,pr:Fa,prel:Ir,prelease:Lr,press:ol,pressBy:rl,progNum:Wi,psus:Jr,psustain:Rr,pure:ot,rand:Z,rand2:_f,randcat:Jf,range:_u,range2:qu,rangex:ku,rarely:eh,rate:yo,ratio:Au,rdim:Bo,real:vi,ref:Ul,register:d,registerControl:c,reify:v,rel:Hn,release:Wn,removeUndefineds:qt,repeatCycles:bl,repeatTime:oc,repl:lh,resonance:mr,rev:on,rfade:zo,ribbon:Sl,ring:pi,ringdf:yi,ringf:mi,rlp:No,room:Mo,roomdim:Oo,roomfade:Po,roomlp:So,roomsize:jo,rotate:We,round:yu,rsize:Ro,run:vf,s:pn,s_add:El,s_alt:zl,s_cat:Y,s_contract:$l,s_expand:jl,s_polymeter:he,s_polymeterSteps:un,s_sub:xl,s_taper:Rl,s_taperlist:Fl,s_tour:Jl,saw:It,saw2:qc,scram:Ci,seconds:Hi,segment:Ku,semitone:wo,seq:sn,sequence:rt,set:Da,setStringParser:za,setTime:Fc,shape:Jo,signal:nt,silence:P,sine:Ac,sine2:ye,size:$o,slice:hn,slide:go,slow:ju,slowChunk:kl,slowcat:yt,slowcatPrime:ae,slowchunk:_l,smear:Ti,sol2note:Ta,someCycles:Zf,someCyclesBy:Yf,sometimes:Xf,sometimesBy:Kf,songPtr:Di,sound:mn,source:yn,sparsity:$u,speak:ch,speed:Go,splice:Wl,splitAt:re,spread:Nr,square:Tc,square2:uf,squeeze:Ff,squiz:Ko,src:gn,stack:R,stackBy:Ja,stackCentre:en,stackLeft:Ze,stackRight:tn,steady:of,steps:Bl,stepsPerOctave:so,striate:Il,struct:Wa,stut:ml,stutWith:hl,stutwith:dl,sub:Ua,superimpose:Ha,sus:In,sustain:Ln,sustainpedal:ti,swing:Yu,swingBy:Xu,sz:Fo,time:Cc,timeCat:ln,timecat:Pl,toBipolar:bu,tokenizeNote:Re,tremdp:ni,tremolo:lc,tremolodepth:ei,tremolorate:si,tremr:ri,tri:lf,tri2:ff,triode:ai,tsdelay:bi,uid:Vi,undegrade:Uf,undegradeBy:Gf,unicodeToBase64:Ue,uniq:Ca,uniqsort:Ma,uniqsortr:Ge,unison:Sr,unit:Uo,v:ir,val:Qi,valueToMidi:la,velocity:_n,vib:rr,vibmod:ar,vibrato:or,vmod:ur,voice:bo,vowel:Xo,waveloss:Yo,wchoose:If,wchooseCycles:zc,when:el,wrandcat:Wf,xfade:dn,xsdelay:wi,zcrush:ac,zdelay:uc,zipWith:oe,zmod:cc,znoise:ic,zoom:Vu,zoomArc:Qu,zoomarc:Gu,zrand:Zi,zzfx:fc},Symbol.toStringTag,{value:"Module"})),Ht=(e="test-canvas",t)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:r=window.devicePixelRatio}=t||{},o=document.querySelector("#"+e);if(!o){o=document.createElement("canvas"),o.id=e,o.width=window.innerWidth*r,o.height=window.innerHeight*r,o.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(o.style.imageRendering="pixelated"),document.body.prepend(o);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{o.width=window.innerWidth*r,o.height=window.innerHeight*r},200)})}return o.getContext(n)};let vt={};function Jc(e){vt[e]!==void 0&&(cancelAnimationFrame(vt[e]),delete vt[e])}function dh(){Object.keys(vt).forEach(e=>Jc(e))}let lt={};m.prototype.draw=function(e,t){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:r=0}=t,o=Math.max(Xt(),0);Jc(n),s=Math.abs(s),lt[n]=(lt[n]||[]).filter(f=>!f.isInFuture(o));let i=this.queryArc(o,o+r).filter(f=>f.hasOnset());lt[n]=lt[n].concat(i);let a;const u=()=>{const f=Xt(),l=f+r;lt[n]=lt[n].filter(p=>p.isInNearPast(s,f));let h=Math.max(a||l,l-1/10);const y=this.queryArc(h,l).filter(p=>p.hasOnset());lt[n]=lt[n].concat(y),a=l,e(lt[n],f,l,this),vt[n]=requestAnimationFrame(u)};return vt[n]=requestAnimationFrame(u),this};const Ah=(e=!0)=>{const t=Ht();e&&t.clearRect(0,0,t.canvas.width,t.canvas.width),dh(),window.strudelScheduler&&clearInterval(window.strudelScheduler)};m.prototype.onPaint=function(){return console.warn("[draw] onPaint was not overloaded. Some drawings might not work"),this};class ph{constructor(t,n){this.onFrame=t,this.onError=n}start(){const t=this;let n=requestAnimationFrame(function s(r){try{t.onFrame(r)}catch(o){t.onError(o)}n=requestAnimationFrame(s)});t.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class Th{constructor(t,n){this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.framer=new ph(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const s=Math.abs(this.drawTime[0]),r=this.drawTime[1],o=this.scheduler.now()+r;if(this.lastFrame===null){this.lastFrame=o;return}const i=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,o-1/10),o);this.lastFrame=o,this.visibleHaps=(this.visibleHaps||[]).filter(u=>u.endClipped>=o-s-r).concat(i.filter(u=>u.hasOnset()));const a=o-r;t(this.visibleHaps,a,this)},s=>{console.warn("draw error",s)})}setDrawTime(t){this.drawTime=t}invalidate(t=this.scheduler,n){if(!t)return;n=n??t.now(),this.scheduler=t;let[s,r]=this.drawTime;const[o,i]=[Math.max(n,0),n+r+.1];this.visibleHaps=this.visibleHaps.filter(u=>u.whole.begin<n);const a=t.pattern.queryArc(o,i);this.visibleHaps=this.visibleHaps.concat(a)}start(t){this.scheduler=t,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function Ch(e){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(e)}let Lc={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function pt(){return Lc}function Mh(e){Lc=e}let ze="#22222210";m.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Ht();let{clientWidth:r,clientHeight:o}=s.canvas;r*=window.devicePixelRatio,o*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,ze=`#200010${i}`;const a=u=>{let f;u=Math.round(u),f=this.slow(1e3).queryArc(u,u),s.fillStyle=ze,s.fillRect(0,0,r,o),f.forEach(l=>{let{x:h,y,w:p,h:_,s:b,r:q,angle:k=0,fill:O="darkseagreen"}=l.value;if(p*=r,_*=o,q!==void 0&&k!==void 0){const N=k*2*Math.PI,[B,J]=[(r-p)/2,(o-_)/2];h=B+Math.cos(N)*q*B,y=J+Math.sin(N)*q*J}else h*=r-p,y*=o-_;const E={...l.value,x:h,y,w:p,h:_};s.fillStyle=O,b==="rect"?s.fillRect(h,y,p,_):b==="ellipse"&&(s.beginPath(),s.ellipse(h+p/2,y+_/2,p/2,_/2,0,0,2*Math.PI),s.fill()),e&&e(s,E,l)}),window.frame=requestAnimationFrame(a)};return window.frame=requestAnimationFrame(a),P};const{x:Ic,y:Sh,w:Nh,h:Oh,angle:Bh,r:Ph,fill:zh,smear:Eh}=de("x","y","w","h","angle","r","fill","smear"),xh=d("rescale",function(e,t){return t.mul(Ic(e).w(e).y(e).h(e))}),jh=d("moveXY",function(e,t,n){return n.add(Ic(e).y(t))}),$h=d("zoomIn",function(e,t){const n=ot(1).sub(e).div(2);return t.rescale(e).move(n,n)}),Nt=(e,t,n)=>e*(n-t)+t,Ee=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:s,freq:r,s:o}=t;if(r)return te(r);if(n=n??s,typeof n=="string")try{return kt(n)}catch{return 0}return typeof n=="number"?n:o?"_"+o:t};m.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:s=0,hideNegative:r=!1,ctx:o=Ht(),id:i=1}=e,a=-t*n,u=t*(1-n);const f=(l,h)=>(!r||l.whole.begin>=0)&&l.isWithinTime(h+a,h+u);return this.draw((l,h)=>{_e({...e,time:h,ctx:o,haps:l.filter(y=>f(y,h))})},{lookbehind:a-s,lookahead:u+s,id:i}),this};function _e({time:e,haps:t,cycles:n=4,playhead:s=.5,flipTime:r=0,flipValues:o=0,hideNegative:i=!1,inactive:a=pt().foreground,active:u=pt().foreground,background:f="transparent",smear:l=0,playheadColor:h=pt().foreground,minMidi:y=10,maxMidi:p=90,autorange:_=0,timeframe:b,fold:q=0,vertical:k=0,labels:O=!1,fill:E=1,fillActive:N=!1,strokeActive:B=!0,stroke:J,hideInactive:tt=0,colorizeInactive:H=1,fontFamily:I,ctx:T,id:at}={}){const L=T.canvas.width,st=T.canvas.height;let ht=-n*s,C=n*(1-s);at&&(t=t.filter(x=>x.hasTag(at))),b&&(console.warn("timeframe is deprecated! use from/to instead"),ht=0,C=b);const M=k?st:L,V=k?L:st;let j=k?[M,0]:[0,M];const dt=C-ht,Pt=k?[0,V]:[V,0];let zt=p-y+1,gt=V/zt,Et=[];r&&j.reverse(),o&&Pt.reverse();const{min:Hc,max:Dc,values:Vc}=t.reduce(({min:x,max:Q,values:Tt},Ct)=>{const G=Ee(Ct);return{min:G<x?G:x,max:G>Q?G:Q,values:Tt.includes(G)?Tt:[...Tt,G]}},{min:1/0,max:-1/0,values:[]});_&&(y=Hc,p=Dc,zt=p-y+1),Et=Vc.sort((x,Q)=>typeof x=="number"&&typeof Q=="number"?x-Q:typeof x=="number"?1:String(x).localeCompare(String(Q))),gt=q?V/Et.length:V/zt,T.fillStyle=f,T.globalAlpha=1,l||(T.clearRect(0,0,L,st),T.fillRect(0,0,L,st)),t.forEach(x=>{const Q=x.whole.begin<=e&&x.endClipped>e;let Tt=J??(B&&Q),Ct=!Q&&E||Q&&N;if(tt&&!Q)return;let G=x.value?.color;u=G||u,a=H&&G||a,G=Q?u:a,T.fillStyle=Ct?G:"transparent",T.strokeStyle=G;const{velocity:Qc=1,gain:Gc=1}=x.value||{};T.globalAlpha=Qc*Gc;const Uc=(x.whole.begin-(r?C:ht))/dt,ke=Nt(Uc,...j);let Mt=Nt(x.duration/dt,0,M);const qe=Ee(x),Kc=q?Et.indexOf(qe)/Et.length:(Number(qe)-y)/zt,Ae=Nt(Kc,...Pt);let Te=0;const Ce=Nt(e/dt,...j);let St;if(k?St=[Ae+1-(o?gt:0),M-Ce+ke+Te+1-(r?0:Mt),gt-2,Mt-2]:St=[ke-Ce+Te+1-(r?Mt:0),Ae+1-(o?0:gt),Mt-2,gt-2],Tt&&T.strokeRect(...St),Ct&&T.fillRect(...St),O){const Xc=x.value.note??x.value.s+(x.value.n?`:${x.value.n}`:""),{label:Me,activeLabel:Yc}=x.value,Zc=(Q&&Yc||Me)??Xc;let ta=k?Mt:gt*.75;T.font=`${ta}px ${I||"monospace"}`,T.fillStyle=Ct?"black":G,T.textBaseline="top",T.fillText(Zc,...St)}}),T.globalAlpha=1;const xt=Nt(-ht/dt,...j);return T.strokeStyle=h,T.beginPath(),k?(T.moveTo(0,xt),T.lineTo(V,xt)):(T.moveTo(xt,0),T.lineTo(xt,V)),T.stroke(),this}function Wc(e,t={}){let[n,s]=e;n=Math.abs(n);const r=s+n,o=n/r;return{fold:1,...t,cycles:r,playhead:o}}const mh=(e={})=>(t,n,s,r)=>_e({ctx:t,time:n,haps:s,...Wc(r,e)});m.prototype.punchcard=function(e){return this.onPaint(mh(e))};m.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function Fh(e){const{drawTime:t,...n}=e;_e({...Wc(t),...n})}function yh(e,t,n,s){const r=(e-90)*Math.PI/180;return[n+Math.cos(r)*t,s+Math.sin(r)*t]}const xe=(e,t,n,s,r=0)=>yh((e+r)*360,t*e,n,s);function je(e){let{ctx:t,from:n=0,to:s=3,margin:r=50,cx:o=100,cy:i=100,rotate:a=0,thickness:u=r/2,color:f=pt().foreground,cap:l="round",stretch:h=1,fromOpacity:y=1,toOpacity:p=1}=e;n*=h,s*=h,a*=h,t.lineWidth=u,t.lineCap=l,t.strokeStyle=f,t.globalAlpha=y,t.beginPath();let[_,b]=xe(n,r,o,i,a);t.moveTo(_,b);const q=1/60;let k=n;for(;k<=s;){const[O,E]=xe(k,r,o,i,a);t.globalAlpha=(k-n)/(s-n)*p,t.lineTo(O,E),k+=q}t.stroke()}function gh(e){let{stretch:t=1,size:n=80,thickness:s=n/2,cap:r="butt",inset:o=3,playheadColor:i="#ffffff",playheadLength:a=.02,playheadThickness:u=s,padding:f=0,steady:l=1,activeColor:h=pt().foreground,inactiveColor:y=pt().gutterForeground,colorizeInactive:p=0,fade:_=!0,ctx:b,time:q,haps:k,drawTime:O,id:E}=e;E&&(k=k.filter(L=>L.hasTag(E)));const[N,B]=[b.canvas.width,b.canvas.height];b.clearRect(0,0,N*2,B*2);const[J,tt]=[N/2,B/2],H={margin:n/t,cx:J,cy:tt,stretch:t,cap:r,thickness:s},I={...H,thickness:u,from:o-a,to:o,color:i},[T]=O,at=l*q;k.forEach(L=>{const st=L.whole.begin<=q&&L.endClipped>q,ht=L.whole.begin-q+o,C=L.endClipped-q+o-f,M=L.value?.color||h,V=p||st?M:y,j=_?1-Math.abs((L.whole.begin-q)/T):1;je({ctx:b,...H,from:ht,to:C,rotate:at,color:V,fromOpacity:j,toOpacity:j})}),je({ctx:b,...I,rotate:at})}m.prototype.spiral=function(e={}){return this.onPaint((t,n,s,r)=>gh({ctx:t,time:n,haps:s,drawTime:r,...e}))};const wh=mt(36),$e=(e,t,n,s)=>{s=s*Math.PI*2;const r=Math.sin(s)*n+e,o=Math.cos(s)*n+t;return[r,o]},Fe=(e,t)=>.5-Math.log2(e/t)%1;function bh({haps:e,ctx:t,id:n,hapcircles:s=1,circle:r=0,edo:o=12,root:i=wh,thickness:a=3,hapRadius:u=6,mode:f="flake",margin:l=10}={}){const h=f==="polygon",y=f==="flake",p=t.canvas.width,_=t.canvas.height;t.clearRect(0,0,p,_);const b=pt().foreground,k=Math.min(p,_)/2-a/2-u-l,O=p/2,E=_/2;n&&(e=e.filter(B=>B.hasTag(n))),t.strokeStyle=b,t.fillStyle=b,t.globalAlpha=1,t.lineWidth=a,r&&(t.beginPath(),t.arc(O,E,k,0,2*Math.PI),t.stroke()),o&&(Array.from({length:o},(B,J)=>{const tt=Fe(i*Math.pow(2,J/o),i),[H,I]=$e(O,E,k,tt);t.beginPath(),t.arc(H,I,u,0,2*Math.PI),t.fill()}),t.stroke());let N=[];t.lineWidth=u,e.forEach(B=>{let J;try{J=Ie(B)}catch{return}const tt=Fe(J,i),[H,I]=$e(O,E,k,tt),T=B.value.color||b;t.strokeStyle=T,t.fillStyle=T;const{velocity:at=1,gain:L=1}=B.value||{},st=at*L;t.globalAlpha=st,N.push([H,I,tt,T,st]),t.beginPath(),s&&(t.moveTo(H+u,I),t.arc(H,I,u,0,2*Math.PI),t.fill()),y&&(t.moveTo(O,E),t.lineTo(H,I)),t.stroke()}),t.strokeStyle=b,t.globalAlpha=1,h&&N.length&&(N=N.sort((B,J)=>B[2]-J[2]),t.beginPath(),t.moveTo(N[0][0],N[0][1]),N.forEach(([B,J,tt,H,I])=>{t.strokeStyle=H,t.globalAlpha=I,t.lineTo(B,J)}),t.lineTo(N[0][0],N[0][1]),t.stroke())}m.prototype.pitchwheel=function(e={}){let{ctx:t=Ht(),id:n=1}=e;return this.tag(n).onPaint((s,r,o)=>bh({...e,time:r,ctx:t,haps:o.filter(i=>i.isActive(r)),id:n}))};let D=[],vh=(e,t)=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},l:t||0,lc:0,listen(r,o){return s.lc=n.push(r,o||s.l)/2,()=>{let i=n.indexOf(r);~i&&(n.splice(i,2),--s.lc||s.off())}},notify(r){let o=!D.length;for(let i=0;i<n.length;i+=2)D.push(n[i],n[i+1],s.value,r);if(o){for(let i=0;i<D.length;i+=4){let a;for(let u=i+1;!a&&(u+=4)<D.length;)D[u]<D[i+1]&&(a=D.push(D[i],D[i+1],D[i+2],D[i+3]));a||D[i](D[i+2],D[i+3])}D.length=0}},off(){},set(r){s.value!==r&&(s.value=r,s.notify())},subscribe(r,o){let i=s.listen(r,o);return r(s.value),i},value:e};return s},Rh=(e={})=>{let t=vh(e);return t.setKey=function(n,s){typeof s>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==s&&(t.value={...t.value,[n]:s},t.notify(n))},t};export{Oc as $,fa as A,ne as B,da as C,Th as D,ie as E,ph as F,W as G,Ul as H,d as I,Ie as J,Rt as K,pa as L,te as M,ma as N,Rh as O,m as P,qh as Q,Qe as R,ot as S,P as T,R as U,g as V,ln as W,Bt as X,rt as Y,it as Z,Ot as _,Bh as a,Z as a0,za as a1,vh as a2,lh as a3,Sa as a4,la as a5,xc as a6,Na as a7,xh as b,Ah as c,Ch as d,pt as e,zh as f,Ht as g,Oh as h,Mh as i,Wc as j,mh as k,Fh as l,jh as m,bh as n,Go as o,_e as p,Jo as q,Ph as r,Eh as s,v as t,Xt as u,kt as v,Nh as w,Ic as x,Sh as y,$h as z};
