import{O as qt,Q as Tt,P as ee,e as Ct,g as me,R as At}from"./index.Dkgbun3A.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,s,a){super(n),o=Math.abs(o),this.delayTime.value=s;const i=n.createGain();i.gain.value=Math.min(Math.abs(a),.995),this.feedback=i.gain;const r=n.createGain();return r.gain.value=o,this.delayGain=r,this.connect(i),this.connect(r),i.connect(this),this.connect=c=>r.connect(c),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var ye={};ye.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,i=Math.round(e.decayTime*o),r=Math.round(a*o),c=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/i),u=n.createBuffer(s,r,o),h=0;h<s;h++){for(var d=u.getChannelData(h),f=0;f<r;f++)d[f]=Bt()*Math.pow(l,f);for(var f=0;f<c;f++)d[f]*=f/c}kt(u,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};ye.generateGraph=function(e,t,n,o,s){var a=document.createElement("canvas");a.width=t,a.height=n;var i=a.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,a.width,a.height),i.fillStyle="#fff";for(var r=t/e.length,c=n/(s-o),l=0;l<e.length;l++)i.fillRect(l*r,n-(e[l]-o)*c,1,1);return a};var kt=function(e,t,n,o,s){if(t==0){s(e);return}var a=St(e),i=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),r=i.createBufferSource();r.buffer=e;var c=i.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),c.type="lowpass",c.Q.value=1e-4,c.frequency.setValueAtTime(t,0),c.frequency.linearRampToValueAtTime(n,o),r.connect(c),c.connect(i.destination),r.start(),i.oncomplete=function(l){s(l.renderedBuffer)},i.startRendering(),window.filterNode=c},St=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},Bt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let s=0;s<t.numberOfChannels;s++){let a=t.getChannelData(s),i=o.getChannelData(s);for(let r=0;r<n;r++)i[r]=a[r]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,s){const a=this.createConvolver();return a.generate=(i=2,r=.1,c=15e3,l=1e3,u)=>{a.duration=i,a.fade=r,a.lp=c,a.dim=l,a.ir=u,u?a.buffer=this.adjustLength(i,u):ye.generateReverb({audioContext:this,numChannels:2,decayTime:i,fadeInTime:r,lpFreqStart:c,lpFreqEnd:l},h=>{a.buffer=h})},a.generate(e,t,n,o,s),a});var Pe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!Pe[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:i}=Pe[o],r=n.createGain();for(let c=0;c<5;c++){const l=n.createGain();l.gain.value=s[c];const u=n.createBiquadFilter();u.type="bandpass",u.Q.value=a[c],u.frequency.value=i[c],this.connect(u),u.connect(l),l.connect(r)}return r.gain.value=8,this.connect=c=>r.connect(c),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let Qe=e=>console.log(e);const x=(...e)=>Qe(...e),xt=e=>{Qe=e},Rt=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},$t={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Gt={"#":1,b:-1,s:1,f:-1},Ke=(e,t=3)=>{const[n,o,s=t]=Rt(e);if(!n)throw new Error('not a note: "'+e+'"');const a=$t[n.toLowerCase()],i=o?.split("").reduce((r,c)=>r+Gt[c],0)||0;return(Number(s)+1)*12+a+i},gn=e=>Math.pow(2,(e-69)/12)*440,te=(e,t,n)=>Math.min(Math.max(e,t),n),Et=e=>12*Math.log(e/440)/Math.LN2+69,Mt=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return Et(n);if(typeof o=="string")return Ke(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t};function $(e,t=0,n){return isNaN(Number(e))?(!n&&x(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Ye=(e,t)=>(e%t+t)%t,ze=(e,t)=>Ye(Math.round($(e,0)),t),Ot="/_astro/worklets.B0Oqm6E5.mjs";function Ze(e){const t=b().createGain();return t.gain.value=e,t}const Le=(e,t,n,o)=>o-n===0?0:(t-e)/(o-n);function j(e,t,n,o){const s=new AudioWorkletNode(e,t,o);return Object.entries(n).forEach(([a,i])=>{s.parameters.get(a).value=i}),s}const ae=(e,t,n,o,s,a,i,r,c,l="exponential")=>{t=$(t),n=$(n),o=$(o),s=$(s);const u=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(a=a===0?.001:a,i=i===0?.001:i);const h=i-a,d=i,f=a+o*h,p=c-r,y=v=>{let m;if(t>v){let A=Le(a,d,0,t);m=v*A+(a>d?a:0)}else m=(v-t)*Le(d,f,0,n)+d;return l==="exponential"&&(m=m||.001),m};e.setValueAtTime(a,r),t>p?e[u](y(p),c):t+n>p?(e[u](y(t),r+t),e[u](y(p),c)):(e[u](y(t),r+t),e[u](y(t+n),r+t+n),e.setValueAtTime(f,c)),e[u](a,c+s)};function Dt(e,t,n,o,s,a){const i={threshold:t??-3,ratio:n??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,i)}const se=(e,t="linear",n)=>{const[i,r,c,l]=e;if(i==null&&r==null&&c==null&&l==null)return n??[.001,.001,1,.01];const u=c??(i!=null&&r==null||i==null&&r==null?1:.001);return[Math.max(i??0,.001),Math.max(r??0,.001),Math.min(u,1),Math.max(l??0,.01)]};function ue(e,t,n,o,s,a,i,r,c,l,u,h,d,f){const p="exponential",[y,v,m,A]=se([s,a,i,r],p,[.005,.14,0,.1]);let C,S;if(d==="ladder"?(C=j(e,"ladder-processor",{frequency:n,q:o,drive:f}),S=C.parameters.get("frequency")):(C=e.createBiquadFilter(),C.type=t,C.Q.value=o,C.frequency.value=n,S=C.frequency),(s??a??i??r??c)!==void 0){c=$(c,1,!0),h=$(h,0,!0);const G=Math.abs(c),F=G*h;let E=te(2**-F*n,0,2e4),R=te(2**(G-F)*n,0,2e4);return c<0&&([E,R]=[R,E]),ae(S,y,v,m,A,E,R,l,u,p),C}return C}let Ie=e=>e<.5?1:1-(e-.5)/.5;function mn(e,t,n=0){const o=b();if(!n)return e;let s=o.createGain(),a=o.createGain();e.connect(s),t.connect(a),s.gain.value=Ie(n),a.gain.value=Ie(1-n);let i=o.createGain();return s.connect(i),a.connect(i),i}let Nt=["linear","exponential"];function Wt(e,t,n,o){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const a=$(t.penv,1,!0),i=Nt[t.pcurve??0];let[r,c,l,u]=se([t.pattack,t.pdecay,t.psustain,t.prelease],i,[.2,.001,1,.001]),h=t.panchor??l;const d=a*100,f=0-d*h,p=d-d*h;ae(e,r,c,l,u,f,p,n,o,i)}function Ft(e,t,n){const{vibmod:o=.5,vib:s}=t;let a;if(s>0){a=b().createOscillator(),a.frequency.value=s;const i=b().createGain();return i.gain.value=o*100,a.connect(i),i.connect(e),a.start(n),a}}function yn(e,t,n,o){const s=e.createConstantSource();s.start(n),s.stop(o),s.onended=()=>{t()}}const _t=(e,t=1,n="sine")=>{const o=b(),s=o.createOscillator();s.type=n,s.frequency.value=e,s.start();const a=new GainNode(o,{gain:t});return s.connect(a),{node:a,stop:i=>s.stop(i)}},jt=(e,t,n,o="sine")=>{const a=e.value*t,i=a*n;return _t(a,i,o)};function vn(e,t,n){const{fmh:o=1,fmi:s,fmenv:a="exp",fmattack:i,fmdecay:r,fmsustain:c,fmrelease:l,fmvelocity:u,fmwave:h="sine",duration:d}=t;let f,p=()=>{};if(s){const v=b().createGain(),m=jt(e,o,s,h);if(f=m.node,p=m.stop,![i,r,c,l,u].find(A=>A!==void 0))f.connect(e);else{const[A,C,S,W]=se([i,r,c,l]),G=n+d;ae(v.gain,A,C,S,W,0,1,n,G,a==="exp"?"exponential":"linear"),f.connect(v),v.connect(e)}}return{stop:p}}const ve={},de={},wn=e=>ve[e];function Vt(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=n,++s;while(e>=n);return e.toFixed(1)+" "+o[s]}const Pt=async(e,t,n,o,s,a,i)=>{let r=0;s!==void 0&&n!==void 0&&x("[sampler] hap has note and freq. ignoring note","warning");let c=Mt({freq:s,note:n},36);r=c-36;const l=b();let u,h=0;if(Array.isArray(a))h=ze(t,a.length),u=a[h];else{const y=m=>Ke(m)-c,v=Object.keys(a).filter(m=>!m.startsWith("_")).reduce((m,A,C)=>!m||Math.abs(y(A))<Math.abs(y(m))?A:m,null);r=-y(v),h=ze(t,a[v].length),u=a[v][h]}i&&(u=await i(u));let d=await Xe(u,l,e,h);o<0&&(d=zt(d));const f=l.createBufferSource();f.buffer=d;const p=1*Math.pow(2,r/12);return f.playbackRate.value=p,f},Xe=(e,t,n,o=0)=>{const s=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!de[e]){x(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();de[e]=fetch(e).then(i=>i.arrayBuffer()).then(async i=>{const r=Date.now()-a,c=Vt(i.byteLength);x(`[sampler] load ${s}... done! loaded ${c} in ${r}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(i);return ve[e]=l,l})}return de[e]};function zt(e){const t=b(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const bn=e=>ve[e];function Je(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Ue(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,o]=e.split("github:");return o=o.endsWith("/")?o.slice(0,-1):o,o.split("/").length===2&&(o+="/main"),`https://raw.githubusercontent.com/${o}/${t}`}const Lt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);n=s._base||n,n=Je(n),n.startsWith("github:")&&(n=Ue(n,""));const a=i=>n+i;Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([i,r])=>[i,(typeof r=="string"?[r]:r).map(a)])),t(o,s)});let et={};function qn(e,t){et[e]=t}function It(e){const t=Object.entries(et).find(([n])=>e.startsWith(n));if(t)return t[1]}const Ht=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const a=It(e);if(a)return a(e);if(e=Je(e),e.startsWith("github:")&&(e=Ue(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[r,c]=e.split("shabda:");e=`https://shabda.ndre.gr/${c}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[r,c]=e.split("shabda/speech");c=c.startsWith("/")?c.substring(1):c;let[l,u]=c.split(":"),h="f",d="en-GB";l&&([d,h]=l.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${h}&language=${d}&strudel=1'`}if(typeof fetch!="function")return;const i=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(r=>r.json()).then(r=>Ht(r,t||r._base||i,n)).catch(r=>{throw console.error(r),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=n;Lt(e,(a,i)=>Kt(a,(r,c,l)=>Qt(r,c,l,i),{type:"sample",samples:i,baseUrl:t,prebake:o,tag:s}),t)},He=[];async function Qt(e,t,n,o,s){let{s:a,freq:i,unit:r,nudge:c=0,cut:l,loop:u,clip:h=void 0,n:d=0,note:f,speed:p=1,loopBegin:y=0,begin:v=0,loopEnd:m=1,end:A=1,duration:C}=t;if(p===0)return;u=a.startsWith("wt_")?1:t.loop;const S=b();let[W,G,F,E]=se([t.attack,t.decay,t.sustain,t.release]);const R=e+c,w=await Pt(a,d,f,p,i,o,s);let Z=Ft(w.detune,t,e);if(S.currentTime>e){x(`[sampler] still loading sound "${a}:${d}"`,"highlight");return}if(!w){x(`[sampler] could not load "${a}:${d}"`,"error");return}w.playbackRate.value=Math.abs(p)*w.playbackRate.value,r==="c"&&(w.playbackRate.value=w.playbackRate.value*w.buffer.duration*1);const L=v*w.buffer.duration;u&&(w.loop=!0,w.loopStart=y*w.buffer.duration-L,w.loopEnd=m*w.buffer.duration-L),w.start(R,L);const re=S.createGain(),I=w.connect(re);if(h==null&&u==null&&t.release==null){const M=w.buffer.duration/w.playbackRate.value;C=(A-v)*M}let H=e+C;ae(I.gain,W,G,F,E,0,1,e,H,"linear"),Wt(w.detune,t,e,H);const Q=S.createGain();I.connect(Q),w.onended=function(){w.disconnect(),Z?.stop(),I.disconnect(),Q.disconnect(),n()};let D=H+E+.01;w.stop(D);const K={node:Q,bufferSource:w,stop:(M,Ce)=>{}};if(l!==void 0){const M=He[l];M&&(M.node.gain.setValueAtTime(1,R),M.node.gain.linearRampToValueAtTime(0,R+.01)),He[l]=K}return K}const we=qt();function Kt(e,t,n={}){we.setKey(e,{onTrigger:t,data:n})}function fe(e){return we.get()[e]}const tt={s:"triangle",gain:.8,postgain:1,density:".03",ftype:"12db",fanchor:0,resonance:1,hresonance:1,bandq:1,channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,delay:0,delayfeedback:.5,delaytime:.25,orbit:1,i:1,velocity:1,fft:8};let be=new Map(Object.entries(tt));function nt(e,t){be.set(e,t)}function T(e){return be.get(e)}function Tn(e){Object.keys(e).forEach(t=>{nt(t,e[t])})}function Yt(){be=new Map(Object.entries(tt))}function Cn(e){Yt(),e==="1.0"&&nt("fanchor",.5)}const An=()=>we.set({});let ne;const Zt=()=>(ne=new AudioContext,ne),b=()=>ne||Zt();let he;function Xt(){return he||(he=b().audioWorklet.addModule(Ot)),he}async function Jt(e={}){const{disableWorklets:t=!1}=e;if(!(typeof window>"u")){if(await b().resume(),t){x("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await Xt(),x("[superdough] AudioWorklets loaded")}catch(n){console.warn("could not load AudioWorklet effects",n)}x("[superdough] ready")}}let pe;async function kn(e){return pe||(pe=new Promise(t=>{document.addEventListener("click",async function n(){document.removeEventListener("click",n),await Jt(e),t()})})),pe}let O={},oe,V;function Ut(){const e=b(),t=e.destination.maxChannelCount;e.destination.channelCount=t,oe=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),V=new GainNode(e),oe.connect(V),V.connect(e.destination)}const qe=(e,t=[0,1])=>{const n=b();oe==null&&Ut();const o=new StereoPannerNode(n);e.connect(o);const s=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(s),t.forEach((a,i)=>{s.connect(oe,i%o.channelCount,te(a,0,n.destination.channelCount-1))})},Sn=()=>{V!=null&&(V.gain.linearRampToValueAtTime(0,b().currentTime+.01),V=null)};function en(e,t,n,o){if(n=te(n,0,.98),!O[e]){const a=b().createFeedbackDelay(1,t,n);a.start?.(o),qe(a,[0,1]),O[e]=a}return O[e].delayTime.value!==t&&O[e].delayTime.setValueAtTime(t,o),O[e].feedback.value!==n&&O[e].feedback.setValueAtTime(n,o),O[e]}function tn(e,t,n=1,o=.5,s=1e3,a=2e3){const i=b(),r=i.createGain();r.gain.value=a*2,j(i,"lfo-processor",{frequency:n,depth:1,skew:0,phaseoffset:0,time:e,end:t,shape:1,dcoffset:-.5}).connect(r);const l=2;let u=0;const h=[];for(let d=0;d<l;d++){const f=i.createBiquadFilter();f.type="notch",f.gain.value=1,f.frequency.value=s+u,f.Q.value=2-Math.min(Math.max(o*2,0),1.9),r.connect(f.detune),u+=282,d>0&&h[d-1].connect(f),h.push(f)}return h[h.length-1]}function nn(e){e=e??0;const t=["12db","ladder","24db"];return typeof e=="number"?t[Math.floor(Ye(e,t.length))]:e}let B={},U=(e,t)=>e!==void 0&&e!==t;function on(e,t,n,o,s,a){if(!B[e]){const r=b().createReverb(t,n,o,s,a);qe(r,[0,1]),B[e]=r}return(U(t,B[e].duration)||U(n,B[e].fade)||U(o,B[e].lp)||U(s,B[e].dim)||B[e].ir!==a)&&B[e].generate(t,n,o,s,a),B[e]}let k={},P={};function an(e,t=1024){if(!k[e]){const n=b().createAnalyser();n.fftSize=t,k[e]=n,P[e]=new Float32Array(k[e].frequencyBinCount)}return k[e].fftSize!==t&&(k[e].fftSize=t,P[e]=new Float32Array(k[e].frequencyBinCount)),k[e]}function ot(e="time",t=1){const n={time:()=>k[t]?.getFloatTimeDomainData(P[t]),frequency:()=>k[t]?.getFloatFrequencyData(P[t])}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),P[t]}function ge(e,t,n){const o=Ze(n);return e.connect(o),o.connect(t),o}function Bn(){O={},B={},k={},P={}}const Te=async(e,t,n)=>{const o=b();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");if(e.duration=n,t=typeof t=="string"&&t.startsWith("=")?Number(t.slice(1)):o.currentTime+t,t<o.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${o.currentTime.toFixed(2)})`);return}let{s=T("s"),bank:a,source:i,gain:r=T("gain"),postgain:c=T("postgain"),density:l=T("density"),fanchor:u=T("fanchor"),drive:h=.69,cutoff:d,lpenv:f,lpattack:p,lpdecay:y,lpsustain:v,lprelease:m,resonance:A=T("resonance"),hpenv:C,hcutoff:S,hpattack:W,hpdecay:G,hpsustain:F,hprelease:E,hresonance:R=T("hresonance"),bpenv:w,bandf:Z,bpattack:L,bpdecay:re,bpsustain:I,bprelease:H,bandq:Q=T("bandq"),channels:D=T("channels"),phaser:ie,phaserdepth:K=T("phaserdepth"),phasersweep:M,phasercenter:Ce,coarse:Ae,crush:ke,shape:Se,shapevol:ct=T("shapevol"),distort:Be,distortvol:lt=T("distortvol"),pan:xe,vowel:Re,delay:$e=T("delay"),delayfeedback:Ge=T("delayfeedback"),delaytime:Ee=T("delaytime"),orbit:Me=T("orbit"),room:Oe,roomfade:ut,roomlp:dt,roomdim:ft,roomsize:ht,ir:ce,i:De=T("i"),velocity:pt=T("velocity"),analyze:Ne,fft:gt=T("fft"),compressor:We,compressorRatio:mt,compressorKnee:yt,compressorAttack:vt,compressorRelease:wt}=e;r=$(r,1),D=(Array.isArray(D)?D:[D]).map(g=>g-1),r*=pt;let Fe=[];const bt=()=>{Fe.forEach(g=>g?.disconnect())};a&&s&&(s=`${a}_${s}`);let X;if(i)X=i(t,e,n);else if(fe(s)){const{onTrigger:g}=fe(s),N=await g(t,e,bt);N&&(X=N.node,N.stop(t+n))}else throw new Error(`sound ${s} not found! Is it loaded?`);if(!X)return;if(o.currentTime>t){x("[webaudio] skip hap: still loading",o.currentTime-t);return}const q=[];q.push(X),q.push(Ze(r));const J=nn(e.ftype);if(d!==void 0){let g=()=>ue(o,"lowpass",d,A,p,y,v,m,f,t,t+n,u,J,h);q.push(g()),J==="24db"&&q.push(g())}if(S!==void 0){let g=()=>ue(o,"highpass",S,R,W,G,F,E,C,t,t+n,u);q.push(g()),J==="24db"&&q.push(g())}if(Z!==void 0){let g=()=>ue(o,"bandpass",Z,Q,L,re,I,H,w,t,t+n,u);q.push(g()),J==="24db"&&q.push(g())}if(Re!==void 0){const g=o.createVowelFilter(Re);q.push(g)}if(Ae!==void 0&&q.push(j(o,"coarse-processor",{coarse:Ae})),ke!==void 0&&q.push(j(o,"crush-processor",{crush:ke})),Se!==void 0&&q.push(j(o,"shape-processor",{shape:Se,postgain:ct})),Be!==void 0&&q.push(j(o,"distort-processor",{distort:Be,postgain:lt})),We!==void 0&&q.push(Dt(o,We,mt,yt,vt,wt)),xe!==void 0){const g=o.createStereoPanner();g.pan.value=2*xe-1,q.push(g)}if(ie!==void 0&&K>0){const g=tn(t,t+n,ie,K,Ce,M);q.push(g)}const Y=new GainNode(o,{gain:c});q.push(Y),qe(Y,D);let _e;if($e>0&&Ee>0&&Ge>0){const g=en(Me,Ee,Ge,t);_e=ge(Y,g,$e)}let je;if(Oe>0){let g;if(ce!==void 0){let le,_=fe(ce);Array.isArray(_)?le=_.data.samples[De%_.data.samples.length]:typeof _=="object"&&(le=Object.values(_.data.samples).flat()[De%Object.values(_.data.samples).length]),g=await Xe(le,o,ce,0)}const N=on(Me,ht,ut,dt,ft,g);je=ge(Y,N,Oe)}let Ve;if(Ne){const g=an(Ne,2**(gt+5));Ve=ge(Y,g,1)}q.slice(1).reduce((g,N)=>g.connect(N),q[0]),Fe=q.concat([_e,je,Ve])},xn=(e,t,n,o)=>Te(t,e-n,t.duration/o);let z;async function sn(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const i=new AudioWorkletNode(e,n);return{node:i,stop:()=>i.port.postMessage("stop")}}const at=()=>{z&&(z?.stop(),z?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?at():e.data?.dough&&z?.node.port.postMessage(e.data)});const Rn=async e=>{const t=b();at(),z=await sn(t,e),z.node.connect(t.destination)};function rn(e,t,n,o,s){window.postMessage({time:s,dough:t.value,currentTime:n,duration:t.duration,cps:o})}const{Pattern:st,logger:cn,repl:ln}=Tt;xt(cn);const rt=e=>(e.ensureObjectValue(),e.value),un=(e,t,n,o)=>Te(rt(t),e-n,t.duration/o),dn=(e,t,n,o,s)=>Te(rt(e),s?`=${s}`:t,n);st.prototype.webaudio=function(){return this.onTrigger(un)};function $n(e={}){return e={getTime:()=>b().currentTime,defaultOutput:dn,...e},ln(e)}st.prototype.dough=function(){return this.onTrigger(rn,1)};function fn(e,{align:t=!0,color:n="white",thickness:o=3,scale:s=.25,pos:a=.75,trigger:i=0,ctx:r=me(),id:c=1}={}){r.lineWidth=o,r.strokeStyle=n;let l=r.canvas;if(!e){r.beginPath();let y=a*l.height;r.moveTo(0,y),r.lineTo(l.width,y),r.stroke();return}const u=ot("time",c);r.beginPath();const h=e.frequencyBinCount;let d=t?Array.from(u).findIndex((y,v,m)=>v&&m[v-1]>-i&&y<=-i):0;d=Math.max(d,0);const f=l.width*1/h;let p=0;for(let y=d;y<h;y++){const v=u[y]+1,m=(a-s*(v-1))*l.height;y===0?r.moveTo(p,m):r.lineTo(p,m),p+=f}r.stroke()}function hn(e,{color:t="white",scale:n=.25,pos:o=.75,lean:s=.5,min:a=-150,max:i=0,ctx:r=me(),id:c=1}={}){if(!e){r.beginPath();let p=o*u.height;r.moveTo(0,p),r.lineTo(u.width,p),r.stroke();return}const l=ot("frequency",c),u=r.canvas;r.fillStyle=t;const h=e.frequencyBinCount,d=u.width*1/h;let f=0;for(let p=0;p<h;p++){const v=At((l[p]-a)/(i-a),0,1)*n,m=v*u.height,A=(o-v*s)*u.height;r.fillRect(f,A,Math.max(d,1),m),f+=d}}function it(e=0,t="0,0,0",n=me()){e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}ee.prototype.fscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(()=>{it(e.smear,"0,0,0",e.ctx),k[t]&&hn(k[t],e)},{id:t})};ee.prototype.tscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||Ct().foreground,e.color,it(e.smear,"0,0,0",e.ctx),fn(k[t],e)},{id:t})};ee.prototype.scope=ee.prototype.tscope;export{sn as $,Ut as A,Cn as B,un as C,$n as D,fn as E,hn as F,fe as G,nt as H,T as I,Tn as J,Yt as K,Jt as L,Sn as M,k as N,P as O,an as P,ot as Q,Te as R,xn as S,wn as T,Pt as U,zt as V,bn as W,Dt as X,ue as Y,x as Z,xt as _,se as a,Rn as a0,rn as a1,ae as b,Ft as c,Wt as d,qe as e,Bn as f,b as g,An as h,kn as i,mn as j,Ze as k,j as l,vn as m,yn as n,Ke as o,te as p,gn as q,Kt as r,we as s,qn as t,Xe as u,Lt as v,dn as w,Qt as x,Ht as y,Zt as z};
