import{j as e}from"./jsx-runtime.DDS51bD4.js";import{r}from"./index.DIn8BZQ7.js";import{T as $,v as G,k as U,_ as Y}from"./index.Dkgbun3A.js";import{S as J,t as K}from"./preload-helper.BO48x9DZ.js";import{i as Q,w as X,g as Z}from"./scope.M_6gkdev.js";import{o as ee,q as te,r as re,v as oe}from"./useClient.C3xvyNXE.js";import{C as se}from"./Claviature.DCnIPR8v.js";import"./_commonjsHelpers.BosuxZz1.js";/* empty css                      */function c({type:s}){return s==="skip"?e.jsx("svg",{fillRule:"evenodd",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",height:"16",width:"10",viewBox:"0 0 320 512",children:e.jsx("path",{d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:{refresh:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"}),play:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"}),pause:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),stop:e.jsx("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1116 0 8 8 0 01-16 0zm5-2.25A.75.75 0 017.75 7h4.5a.75.75 0 01.75.75v4.5a.75.75 0 01-.75.75h-4.5a.75.75 0 01-.75-.75v-4.5z",clipRule:"evenodd"}),skip:e.jsx("path",{fillRule:"evenodd",d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z",clipRule:"evenodd"})}[s]})}let y,R,M;typeof window<"u"&&(y=ee(),R=te(),M=Q());function be({tune:s,tunes:n,hideHeader:N=!1,canvasHeight:H=100,onTrigger:f,punchcard:a,punchcardLabels:S=!0,claviature:u,claviatureLabels:z,maxHeight:p}){const g=n?n[0]:s,h=r.useMemo(()=>ie(),[]),m=r.useMemo(()=>`canvas-${h}`,[h]),V=!!a||!!u,A=!!a,T=a?[0,4]:[0,0],[I,B]=r.useState([]),D=r.useCallback(({code:t,shouldDraw:C})=>{const F=C?document.querySelector("#"+m)?.getContext("2d"):null,d=new J({id:h,defaultOutput:X,getTime:()=>Z().currentTime,transpiler:K,autodraw:!!C,root:b.current,initialCode:"// LOADING",pattern:$,drawTime:T,drawContext:F,editPattern:(o,ne)=>(f&&(o=o.onTrigger(f,!1)),u&&d?.painters.push((le,ae,W,de)=>{const _=W.map(l=>l.value.note).filter(Boolean).map(l=>typeof l=="string"?G(l):l);B(_)}),a&&d?.painters.push(U({labels:!!S})),o),prebake:async()=>Promise.all([R,y]),onUpdateState:o=>{L({...o})},beforeEval:()=>M,afterEval:({code:o})=>re(o)});d.setCode(t),i.current=d},[]),[E,L]=r.useState({}),{started:x,isDirty:O,error:v}=E,i=r.useRef(),b=r.useRef(),P=oe(),[j,q]=r.useState(0),w=t=>{t=Y(t,n.length),q(t),i.current?.setCode(n[t]),i.current?.evaluate()};return P?e.jsxs("div",{className:"overflow-hidden rounded-t-md bg-background border border-lineHighlight",children:[!N&&e.jsxs("div",{className:"flex justify-between bg-lineHighlight",children:[e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:k("cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",x?"animate-pulse":""),onClick:()=>i.current?.toggle(),children:e.jsx(c,{type:x?"stop":"play"})}),e.jsx("button",{className:k("w-16 flex items-center justify-center p-1 text-foreground border-lineHighlight bg-lineHighlight",O?"text-foreground hover:bg-background cursor-pointer":"opacity-50 cursor-not-allowed"),onClick:()=>i.current?.evaluate(),children:e.jsx(c,{type:"refresh"})})]}),n&&e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",onClick:()=>w(j-1),children:e.jsx("div",{className:"rotate-180",children:e.jsx(c,{type:"skip"})})}),e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",onClick:()=>w(j+1),children:e.jsx(c,{type:"skip"})})]})]}),e.jsxs("div",{className:"overflow-auto relative p-1",style:p?{maxHeight:`${p}px`}:{},children:[e.jsx("div",{ref:t=>{i.current||(b.current=t,D({code:g,shouldDraw:V}))}}),v&&e.jsx("div",{className:"text-right p-1 text-md text-red-200",children:v.message})]}),A&&e.jsx("canvas",{id:m,className:"w-full pointer-events-none border-t border-lineHighlight",height:H,ref:t=>{t&&t.width!==t.clientWidth&&(t.width=t.clientWidth)}}),u&&e.jsx(se,{options:{range:["C2","C6"],scaleY:.75,colorize:[{keys:I,color:"steelblue"}],labels:z||{}}})]}):e.jsx("pre",{children:g})}function k(...s){return s.filter(Boolean).join(" ")}function ie(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}export{be as MiniRepl};
